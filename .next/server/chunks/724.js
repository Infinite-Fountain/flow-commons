exports.id=724,exports.ids=[724],exports.modules={4010:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2994,23)),Promise.resolve().then(a.t.bind(a,6114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,9671,23)),Promise.resolve().then(a.t.bind(a,1868,23)),Promise.resolve().then(a.t.bind(a,4759,23))},2546:()=>{},1058:(e,t,a)=>{"use strict";a.d(t,{s:()=>F});var n=a(326),l=a(7577),r=a(9245),s=a(7804),i=a(8408),o=a(2750);let d=(0,i.U)()((0,o.n)(e=>({aspect:"1:1",setAspect:t=>e(e=>{e.aspect=t}),background:{mode:"solid",from:"#000000",to:"#000000"},setBackground:t=>e(e=>{e.background=t}),items:[],overlay:[],setOverlay:t=>e(e=>{e.overlay=t}),layers:[{id:"background",name:"Background",z:0}],ui:{showBackgroundModal:!1,showLayersModal:!1,showBoxModal:!1,currentTool:"none"},selectedId:null,addItem:t=>e(e=>{e.items.push(t)}),updateItem:(t,a)=>e(e=>{let n=e.items.findIndex(e=>e.id===t);n>=0&&Object.assign(e.items[n],a)}),setItems:t=>e(e=>{e.items=t}),addOverlay:t=>e(e=>{e.overlay.push(t)}),updateOverlay:(t,a)=>e(e=>{let n=e.overlay.findIndex(e=>e.id===t);n>=0&&Object.assign(e.overlay[n],a)}),addLayer:t=>e(e=>{e.layers.push(t)}),setLayers:t=>e(e=>{e.layers=t}),moveLayerUp:t=>e(e=>{if("background"===t)return;let a=e.layers.findIndex(e=>e.id===t);if(a>=0&&a<e.layers.length-1){let t=e.layers[a];e.layers[a]=e.layers[a+1],e.layers[a+1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),moveLayerDown:t=>e(e=>{let a=e.layers.findIndex(e=>e.id===t);if(a>0){if(e.layers[a-1]?.id==="background")return;let t=e.layers[a];e.layers[a]=e.layers[a-1],e.layers[a-1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),openBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!0}),closeBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!1}),openLayersModal:()=>e(e=>{e.ui.showLayersModal=!0}),closeLayersModal:()=>e(e=>{e.ui.showLayersModal=!1}),setTool:t=>e(e=>{e.ui.currentTool=t}),setSelectedId:t=>e(e=>{e.selectedId=t}),openBoxModal:t=>e(e=>{e.selectedId=t,e.ui.showBoxModal=!0}),closeBoxModal:()=>e(e=>{e.ui.showBoxModal=!1}),createBox:t=>{let a=t.id;if(!a){let e=Math.random().toString(36).slice(2,7);a=`box_${Date.now()}_${e}`}let n=Math.max(16,Math.round(t.w)),l=Math.max(16,Math.round(t.h));return e(e=>{let r=e.layers.length;e.overlay.push({id:a,x:Math.round(t.x),y:Math.round(t.y),w:n,h:l,contentType:t.contentType??"none"}),e.layers.push({id:a,name:t.name??a,z:r}),e.ui.currentTool="none",e.selectedId=a}),a}})));var c=a(2585),u=a(76),x=a(1552);let p={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},h=(0,c.C6)().length?(0,c.C6)()[0]:(0,c.ZF)(p),g=(0,u.ad)(h);function m({projectId:e="demo",canvasId:t="root",scope:a={type:"root"},presentation:r=!1,isAuthorized:i=!1}){let o=d(e=>e.overlay);d(e=>e.setOverlay);let c=d(e=>e.updateOverlay),x=d(e=>e.layers);d(e=>e.setLayers);let p=d(e=>e.createBox),h=d(e=>e.ui.currentTool),m=d(e=>e.setTool),y=d(e=>e.openBoxModal),j=(0,l.useRef)(null),[w,N]=(0,l.useState)(null),[I,S]=(0,l.useState)(null),C=d(e=>e.selectedId),k=d(e=>e.setSelectedId),E=(0,l.useMemo)(()=>{let e={};return x.forEach(t=>{e[t.id]=t.z}),e},[x]),_=()=>{let n=["interoperable-canvas",e];return a?.type==="child"&&n.push("child-canvases",a.childId),n.push("canvases",t),n};return(0,n.jsxs)("div",{ref:j,className:"w-full h-full absolute inset-0",style:{zIndex:1},onPointerDown:e=>{if(r||!i||"add-box"!==h)return;let t=j.current?.getBoundingClientRect();if(!t)return;let a=e.clientX-t.left,n=e.clientY-t.top;N({x:a,y:n}),S({x:a,y:n,w:0,h:0})},onPointerMove:e=>{if(r||!i||"add-box"!==h||!w)return;let t=j.current?.getBoundingClientRect();if(!t)return;let a=e.clientX-t.left,n=e.clientY-t.top,l=Math.min(w.x,a);S({x:l,y:Math.min(w.y,n),w:Math.abs(a-w.x),h:Math.abs(n-w.y)})},onPointerUp:()=>{if(r||!i||"add-box"!==h||!w||!I)return;let e=Math.max(40,I.w),t=Math.max(40,I.h),a=p({x:I.x,y:I.y,w:e,h:t}),n=(0,u.JU)(g,_().concat(["overlay",a]).join("/")),l=(Array.isArray(o)?o.length:0)+1,s=`Box ${l}`,d=`${s}_${(()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`})()}`;(0,u.pl)(n,{id:a,x:Math.round(I.x),y:Math.round(I.y),w:e,h:t,contentType:"none",name:s,nameKey:d},{merge:!0}),k(a),N(null),S(null),m("none")},children:[(i||r)&&o.map(e=>n.jsx(s.s,{size:{width:e.w,height:e.h},position:{x:e.x,y:e.y},disableDragging:r||!i,disableResizing:r||!i,onDragStop:r||!i?void 0:(t,a)=>{let n=Math.round(a.x),l=Math.round(a.y);c(e.id,{x:n,y:l});let r=(0,u.JU)(g,_().concat(["overlay",e.id]).join("/"));(0,u.pl)(r,{x:n,y:l},{merge:!0})},onResizeStop:r||!i?void 0:(t,a,n,l,r)=>{let s=Math.round(n.offsetWidth),i=Math.round(n.offsetHeight),o=Math.round(r.x),d=Math.round(r.y);c(e.id,{w:s,h:i,x:o,y:d});let x=(0,u.JU)(g,_().concat(["overlay",e.id]).join("/"));(0,u.pl)(x,{w:s,h:i,x:o,y:d},{merge:!0})},bounds:"parent",style:{border:r?"none":e.id===C?"2px solid #ffcf33":"none",background:(()=>{let t=e.background;return t&&"none"!==t.mode?"solid"===t.mode?t.from??"#000000":"linear"===t.mode?`linear-gradient(135deg, ${t.from??"#000000"}, ${t.to??"#000000"})`:"radial"===t.mode?`radial-gradient(circle, ${t.from??"#000000"}, ${t.to??"#000000"})`:"transparent":"transparent"})(),borderRadius:8,overflow:"hidden",zIndex:E[e.id]??1},onClick:r||!i?void 0:()=>k(e.id),onDoubleClick:r||!i?void 0:()=>y(e.id),children:(0,n.jsxs)("div",{className:"w-full h-full",children:["text"===e.contentType&&n.jsx(v,{text:e.text?.content??"",color:e.text?.color??"#ffffff",bold:!!e.text?.bold,align:e.text?.align??"left",fitToWidth:!!e.text?.fitToWidth,baseFontSize:e.text?.fontSize??18}),"image"===e.contentType&&e.imageSrc&&n.jsx("img",{src:e.imageSrc,alt:"",style:{width:"100%",height:"100%",objectFit:e.imageBehavior??"contain",objectPosition:"center"}}),"animation"===e.contentType&&e.lottieSrc&&n.jsx(b,{lottieSrc:e.lottieSrc,loop:e.loop??!0,autoplay:e.autoplay??!0}),"dune"===e.contentType&&n.jsx(f,{dune:e.dune})]})},e.id)),"add-box"===h&&I&&n.jsx("div",{className:"absolute border-2 border-blue-400/70 bg-blue-400/10",style:{left:I.x,top:I.y,width:I.w,height:I.h,pointerEvents:"none"}})]})}function v({text:e,color:t,bold:a,align:r,fitToWidth:s,baseFontSize:i}){let o=(0,l.useRef)(null),[d,c]=(0,l.useState)(i),[u,x]=(0,l.useState)(1.2);return n.jsx("div",{ref:o,style:{color:t,fontSize:d,fontWeight:a?700:400,lineHeight:u,display:"flex",alignItems:"center",justifyContent:"left"===r?"flex-start":"center"===r?"center":"flex-end",width:"100%",height:"100%",padding:8,textAlign:r,wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:e})}function b({lottieSrc:e,loop:t,autoplay:a}){let[s,i]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0);return o||!s?n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:n.jsx("div",{className:"text-xs text-gray-500",children:"Loading..."})}):n.jsx(r.ZP,{animationData:s,loop:"boolean"==typeof t?t:t>0,autoplay:a,style:{width:"100%",height:"100%"},renderer:"canvas",rendererSettings:{progressiveLoad:!0,clearCanvas:!0,preserveAspectRatio:"none",dpr:1}})}function f({dune:e}){let[t,a]=(0,l.useState)(null),[r,s]=(0,l.useState)(!0),[i,o]=(0,l.useState)(null),d=(0,l.useRef)(null);return((0,l.useRef)(null),e?.queryId)?r?n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-gray-200 text-xs",children:n.jsx("div",{children:"Loading Dune data..."})}):i?n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-red-300 text-xs px-2",children:(0,n.jsxs)("div",{className:"text-center",children:[n.jsx("div",{className:"font-semibold",children:"Error"}),n.jsx("div",{children:i})]})}):0===(t?.result?.rows??[]).length?n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-gray-200 text-xs",children:n.jsx("div",{children:"No data returned from query"})}):n.jsx("div",{className:"w-full h-full relative",style:{background:"white"},children:n.jsx("canvas",{ref:d,className:"absolute inset-0 w-full h-full"})}):n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-gray-200 text-xs px-2",children:"Add a Dune URL or query_id in the box settings."})}function y({projectId:e="demo",scope:t={type:"root"},canvasId:a="root",presentation:l=!1,isAuthorized:r=!1}){return n.jsx("div",{className:"w-full h-full relative",children:n.jsx(m,{projectId:e,canvasId:a,scope:t,presentation:l,isAuthorized:r})})}function j(){let e=d(e=>e.openBackgroundModal),t=d(e=>e.setTool);return(0,n.jsxs)("div",{className:"space-y-2 relative",children:[n.jsx("button",{className:"w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>t("add-box"),children:"Add Box"}),n.jsx("button",{className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>e(),children:"Background"}),n.jsx("button",{className:"w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:d.getState().openLayersModal,children:"Layers"})]})}function w({onAspectChange:e}){let{aspect:t,setAspect:a}=d(),l=t=>{a(t),e?.(t)};return(0,n.jsxs)("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Aspect Ratio"}),(0,n.jsxs)("select",{value:t,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",children:[n.jsx("option",{value:"16:9",children:"16:9 (Widescreen)"}),n.jsx("option",{value:"4:3",children:"4:3 (Standard)"}),n.jsx("option",{value:"1:1",children:"1:1 (Square)"}),n.jsx("option",{value:"4:6",children:"4:6 (Vertical Post)"}),n.jsx("option",{value:"9:16",children:"9:16 (Vertical Stories)"}),n.jsx("option",{value:"mini-app",children:"Mini App (9:16 safe)"}),n.jsx("option",{value:"landing-page",children:"Desktop Landing (Infinite Height)"}),n.jsx("option",{value:"mobile-landing-page",children:"Mobile Landing (Infinite Height)"})]})]})}function N({from:e,to:t,className:a="",style:r={}}){let s=(0,l.useRef)(null),[i,o]=(0,l.useState)(1),[d,c]=(0,l.useState)(()=>800);return n.jsx("div",{ref:s,className:`absolute inset-0 w-full ${a}`,style:{...r,zIndex:0,pointerEvents:"none"},children:Array.from({length:i}).map((a,l)=>{let r=l%2==0,s=l*d*2,i=`${e} 0%, ${t} 50%, ${e} 100%`;return n.jsx("div",{className:"absolute left-0 right-0",style:{top:`${s}px`,height:`${2*d}px`,width:"100%",background:r?`linear-gradient(135deg, ${i})`:`linear-gradient(225deg, ${i})`,zIndex:0,pointerEvents:"none"}},l)})})}function I({aspect:e,backgroundColor:t,backgroundMode:a,backgroundFrom:r,backgroundTo:s,className:i="",children:o,presentation:c=!1,fullscreen:u=!1}){let x=d(e=>e.overlay),[p,h]=(0,l.useState)(()=>800),g=()=>{switch(e){case"1:1":default:return"aspect-square";case"16:9":return"aspect-video";case"4:3":return"aspect-[4/3]";case"9:16":case"mini-app":return"aspect-[9/16]";case"4:6":return"aspect-[4/6]";case"landing-page":case"mobile-landing-page":return""}},m=(0,l.useMemo)(()=>{if("landing-page"!==e&&"mobile-landing-page"!==e)return null;if(0===x.length)return p;let t=x.reduce((e,t)=>{let a=t.y+t.h;return a>e?a:e},0),a=.5*p;return Math.max(p,t+a)},[e,x,p]),v=()=>"landing-page"===e||"mobile-landing-page"===e?"w-full flex justify-center":"w-full h-screen flex items-center justify-center",b=()=>u?`${g()} w-full h-full`:"landing-page"===e?c?"block mt-[20px] box-border":"block mt-[20px] box-border w-full max-w-full":"mobile-landing-page"===e?"block mt-[20px] box-border":"1:1"===e?`${g()} h-[95%] max-w-full mx-[10px]`:"16:9"===e?`${g()} w-full max-h-full mx-[20px]`:"4:3"===e?`${g()} h-[95%] max-w-full mx-[20px]`:`${g()} h-[95%] max-w-full mx-[10px]`;return"mini-app"===e?n.jsx("div",{className:`${v()} ${i}`,children:n.jsx("div",{className:b(),children:(0,n.jsxs)("div",{className:"w-full h-full relative overflow-hidden",style:{background:t||"transparent",position:"relative"},children:["zigzag"===a&&r&&s&&n.jsx(N,{from:r,to:s}),!c&&n.jsx("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:0,height:"10%",background:"#ffffff",borderBottom:"1px solid rgba(0,0,0,0.08)",pointerEvents:"none",zIndex:2}}),n.jsx("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:c?"0%":"10%",bottom:"2.5%"},children:n.jsx("div",{className:"w-full h-full relative",style:{zIndex:1},children:o})})]})})}):"landing-page"===e?n.jsx("div",{className:`${v()} ${i}`,children:n.jsx("div",{className:b(),style:{minHeight:m||"100vh",height:m?`${m}px`:"auto",width:c?"1100px":"100%",maxWidth:c?"1100px":"100%",boxSizing:"border-box",border:"none"},children:(0,n.jsxs)("div",{className:"w-full relative mx-auto",style:{background:t||"transparent",minHeight:m||"100vh",height:m?`${m}px`:"auto",width:c?"1100px":"100%",maxWidth:c?"1100px":"100%",boxSizing:"border-box",border:"none",zIndex:c?1:"auto",position:"relative"},children:["zigzag"===a&&r&&s&&n.jsx(N,{from:r,to:s}),o]})})}):"mobile-landing-page"===e?n.jsx("div",{className:`${v()} ${i}`,children:n.jsx("div",{className:b(),style:{minHeight:m||"100vh",height:m?`${m}px`:"auto",width:"390px",maxWidth:"390px",boxSizing:"border-box",border:"none"},children:(0,n.jsxs)("div",{className:"w-full relative mx-auto",style:{background:t||"transparent",minHeight:m||"100vh",height:m?`${m}px`:"auto",width:"390px",maxWidth:"390px",boxSizing:"border-box",border:"none",zIndex:c?1:"auto",position:"relative"},children:["zigzag"===a&&r&&s&&n.jsx(N,{from:r,to:s}),o]})})}):n.jsx("div",{className:`${v()} ${i}`,children:n.jsx("div",{className:b(),children:(0,n.jsxs)("div",{className:"w-full h-full relative overflow-hidden",style:{background:t||"transparent",position:"relative"},children:["zigzag"===a&&r&&s&&n.jsx(N,{from:r,to:s}),o]})})})}function S({open:e,mode:t,from:a,to:r,onClose:s,onSave:i}){let[o,d]=(0,l.useState)(t??"linear"),[c,u]=(0,l.useState)(a),[x,p]=(0,l.useState)(r),h=(0,l.useMemo)(()=>"solid"===o?c:"linear"===o?`linear-gradient(135deg, ${c}, ${x})`:"radial"===o?`radial-gradient(circle, ${c}, ${x})`:"zigzag"===o?`linear-gradient(135deg, ${c}, ${x})`:"transparent",[o,c,x]);return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[n.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Background"}),(0,n.jsxs)("div",{className:"space-y-4",children:[n.jsx("div",{className:"h-24 rounded",style:{background:h}}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:"Type"}),(0,n.jsxs)("select",{className:"w-full px-3 py-2 border rounded",value:o,onChange:e=>d(e.target.value),children:[n.jsx("option",{value:"none",children:"No background"}),n.jsx("option",{value:"solid",children:"Solid"}),n.jsx("option",{value:"linear",children:"Linear gradient"}),n.jsx("option",{value:"radial",children:"Radial gradient"}),n.jsx("option",{value:"zigzag",children:"Zigzag gradient"})]})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:"From Color"}),n.jsx("input",{type:"color",value:c,onChange:e=>u(e.target.value),className:"w-full h-10 border rounded"})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:"To Color"}),n.jsx("input",{type:"color",value:x,onChange:e=>p(e.target.value),className:"w-full h-10 border rounded"})]})]}),(0,n.jsxs)("div",{className:"flex gap-2 mt-6",children:[n.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"}),n.jsx("button",{onClick:()=>{"none"===o?i({mode:"none",from:"transparent",to:"transparent"}):"solid"===o?i({mode:"solid",from:c,to:c}):"linear"===o?i({mode:"linear",from:c,to:x}):"radial"===o?i({mode:"radial",from:c,to:x}):"zigzag"===o&&i({mode:"zigzag",from:c,to:x})},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"})]})]})}):null}(0,x.cF)(h);let C={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},k=(0,c.C6)().length?(0,c.C6)()[0]:(0,c.ZF)(C),E=(0,u.ad)(k);function _({open:e,onClose:t,projectId:a,canvasId:r="root",scope:s={type:"root"}}){let i=d(e=>e.layers),o=d(e=>e.overlay),c=d(e=>e.moveLayerUp),x=d(e=>e.moveLayerDown),p=d(e=>e.selectedId),h=d(e=>e.setSelectedId),[g,m]=(0,l.useState)(null),[v,b]=(0,l.useState)(""),f=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`},y=()=>{let e=["interoperable-canvas",a];return s?.type==="child"&&e.push("child-canvases",s.childId),e.push("canvases",r),e},j=async(e,t)=>{if(!t.trim()||!a){m(null);return}let n=`${t.trim()}_${f()}`,l=(0,u.JU)(E,y().concat(["overlay",e]).join("/"));await (0,u.pl)(l,{name:t.trim(),nameKey:n},{merge:!0}),m(null)};return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Layers"}),n.jsx("button",{onClick:t,className:"px-3 py-1 border rounded hover:bg-gray-50",children:"Close"})]}),(0,n.jsxs)("div",{className:"space-y-2 max-h-80 overflow-auto",children:[0===i.length&&n.jsx("div",{className:"text-sm text-gray-500",children:"No layers yet. Add items to populate."}),[...i].sort((e,t)=>t.z-e.z).map(e=>(0,n.jsxs)("div",{className:`flex items-center justify-between border rounded px-3 py-2 ${p===e.id?"bg-gray-100":""}`,onClick:()=>"background"!==e.id&&h(e.id),children:[n.jsx("div",{className:"truncate",children:g===e.id?n.jsx("input",{className:"text-sm border rounded px-1 py-0.5 w-40",autoFocus:!0,value:v,onChange:e=>b(e.target.value),onKeyDown:t=>{let a=o.find(t=>t.id===e.id)?.name||e.name||e.id;"Enter"===t.key&&(t.preventDefault(),j(e.id,v||a)),"Escape"===t.key&&m(null)},onBlur:()=>{let t=o.find(t=>t.id===e.id)?.name||e.name||e.id;j(e.id,v||t)}}):n.jsx("button",{className:"font-medium text-left truncate",onClick:t=>{t.stopPropagation();let a=o.find(t=>t.id===e.id)?.name||e.name||e.id;m(e.id),b(a)},children:o.find(t=>t.id===e.id)?.name||e.name||e.id})}),(0,n.jsxs)("div",{className:"flex gap-1",children:["background"!==e.id&&n.jsx("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Up",onClick:t=>{t.stopPropagation(),c(e.id)},children:"▲"}),"background"!==e.id&&e.z>1&&n.jsx("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Down",onClick:t=>{t.stopPropagation(),x(e.id)},children:"▼"})]})]},e.id))]})]})}):null}let B={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},$=(0,c.C6)().length?(0,c.C6)()[0]:(0,c.ZF)(B),A=(0,u.ad)($),T=(0,x.cF)($);function M({projectId:e="demo",canvasId:t="root",scope:a={type:"root"}}){let s=d(e=>e.ui.showBoxModal),i=d(e=>e.closeBoxModal),o=d(e=>e.selectedId),c=d(e=>e.overlay),p=(0,l.useMemo)(()=>c.find(e=>e.id===o),[c,o]),[h,g]=(0,l.useState)("background"),[m,v]=(0,l.useState)({}),[b,f]=(0,l.useState)([""]),y=(0,l.useRef)(null),j=(0,l.useRef)(null),[w,N]=(0,l.useState)(!1),[I,S]=(0,l.useState)(null),[C,k]=(0,l.useState)(null),[E,_]=(0,l.useState)(null),[B,$]=(0,l.useState)(!1),[M,U]=(0,l.useState)(!1),[z,L]=(0,l.useState)([]),[R,D]=(0,l.useState)(!1),F=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`},O=async()=>{try{let t=(0,u.hJ)(A,"interoperable-canvas",e,"images"),a=await (0,u.PL)(t),n=[];for(let e of a.docs){let t=e.data(),a=t?.storagePath,l=t?.filename??e.id;if(a)try{let t=(0,x.iH)(T,a),r=await (0,x.Jt)(t);n.push({id:e.id,name:l,url:r})}catch{}}L(n)}catch{L([])}};if(!s||!o)return null;let K=async t=>{if(S(null),t){if(!("image/jpeg"===t.type||"image/png"===t.type)){S("Only JPG or PNG files are accepted.");return}if(t.size>1048576){S("Maximum size is 1MB.");return}N(!0);try{let n=t.name,l=n.lastIndexOf("."),r=l>-1?n.slice(0,l):n,s=l>-1?n.slice(l+1):"jpg",i=`${r}_${F()}.${s}`,o=a?.type==="child"?`interoperable-canvas/assets/${e}/child-canvases/${a.childId}/images/${i}`:`interoperable-canvas/assets/${e}/images/${i}`,d=(0,x.iH)(T,o);await (0,x.KV)(d,t,{contentType:t.type,cacheControl:"public, max-age=31536000, immutable"});let c=await (0,x.Jt)(d),h=URL.createObjectURL(t);k(h);let g=await new Promise(e=>{let t=new Image;t.onload=()=>{e({width:t.naturalWidth,height:t.naturalHeight}),URL.revokeObjectURL(h)},t.src=h}),b=(0,u.JU)(A,"interoperable-canvas",e,"images",i);await (0,u.pl)(b,{filename:i,originalName:n,storagePath:o,mimeType:t.type,sizeBytes:t.size,width:g.width,height:g.height,uploadedAt:(0,u.Bt)()},{merge:!0}),v({...m,imageSrc:c,imageBehavior:m.imageBehavior??p?.imageBehavior??"contain"}),$(!0)}catch(e){S("Upload failed. Please try again.")}finally{N(!1)}}},J=async()=>{let e=!M;U(e),e&&0===z.length&&await O()},X=async t=>{if(S(null),t){if(!("application/json"===t.type||t.name.endsWith(".json"))){S("Only JSON files are accepted.");return}if(t.size>2097152){S("Maximum size is 2MB.");return}N(!0);try{let n=t.name,l=n.lastIndexOf("."),r=l>-1?n.slice(0,l):n,s=`${r}_${F()}.json`,i=a?.type==="child"?`interoperable-canvas/assets/${e}/child-canvases/${a.childId}/animations/${s}`:`interoperable-canvas/assets/${e}/animations/${s}`,o=(0,x.iH)(T,i);await (0,x.KV)(o,t,{contentType:"application/json",cacheControl:"public, max-age=31536000, immutable"});let d=await (0,x.Jt)(o),c=new FileReader;c.onload=e=>{try{let t=JSON.parse(e.target?.result);_(t),v({...m,lottieSrc:d})}catch(e){console.error("Failed to parse Lottie JSON:",e),S("Invalid Lottie JSON file.")}},c.readAsText(t);let p=(0,u.JU)(A,"interoperable-canvas",e,"animations",s);await (0,u.pl)(p,{filename:s,originalName:n,storagePath:i,mimeType:"application/json",sizeBytes:t.size,uploadedAt:(0,u.Bt)()},{merge:!0})}catch(e){S("Upload failed. Please try again.")}finally{N(!1)}}},W=()=>{let n=["interoperable-canvas",e];return a?.type==="child"&&n.push("child-canvases",a.childId),n.push("canvases",t),n},H=async()=>{if(!o)return;let e=(0,u.JU)(A,W().concat(["overlay",o]).join("/")),t={};"background"===h&&(t.background=m.background??{mode:"none"});let a="text"===h?"text":"image"===h?"image":"animation"===h?"animation":"dune"===h?"dune":null;if(a&&p?.contentType&&p.contentType!==a){let e={text:"text",image:"image",animation:"animation",dune:"dune"},t=e[p.contentType]??null;if(t&&!window.confirm(`You can only add one asset per box. Adding ${e[a]} will remove ${t}. Continue?`))return}if("text"===h&&(t.contentType="text",t.text={content:m.text??p?.text?.content??"",fontSize:void 0!==m.fontSize?Number(m.fontSize):p?.text?.fontSize??18,color:m.color??p?.text?.color??"#ffffff",bold:void 0!==m.bold?!!m.bold:p?.text?.bold??!1,align:m.align??p?.text?.align??"left",fitToWidth:void 0!==m.fitToWidth?!!m.fitToWidth:p?.text?.fitToWidth??!1},Object.assign(t,{imageSrc:(0,u.AK)(),lottieSrc:(0,u.AK)(),duneQueryId:(0,u.AK)()})),"image"===h){let e=m.imageSrc??p?.imageSrc;if(!e){window.alert("Please upload or select an image before saving.");return}Object.assign(t,{contentType:"image",imageSrc:e,imageBehavior:m.imageBehavior??p?.imageBehavior??"contain"}),Object.assign(t,{text:(0,u.AK)(),lottieSrc:(0,u.AK)(),duneQueryId:(0,u.AK)()})}if("animation"===h){let e=m.lottieSrc??p?.lottieSrc;if(!e){window.alert("Please upload a Lottie JSON file before saving.");return}Object.assign(t,{contentType:"animation",lottieSrc:e,loop:void 0!==m.loop?m.loop:p?.loop??!0,autoplay:void 0!==m.autoplay?m.autoplay:p?.autoplay??!0}),Object.assign(t,{text:(0,u.AK)(),imageSrc:(0,u.AK)(),duneQueryId:(0,u.AK)()})}if("dune"===h){let{queryId:e,vizId:a,sourceUrl:n}=function(e){let t=(e||"").trim();if(!t)return{};if(/^\d+$/.test(t))return{queryId:t};try{let e=new URL(t).pathname.split("/").filter(Boolean),a=e.findIndex(e=>"queries"===e.toLowerCase());if(a>=0&&e[a+1]){let n=e[a+1],l=e[a+2];return{queryId:n,vizId:l,sourceUrl:t}}let n=e.map(e=>e.match(/^(\d+)$/)?.[1]).filter(Boolean);if(n.length>0)return{queryId:n[0],vizId:n[1],sourceUrl:t};return{sourceUrl:t}}catch{return{}}}((m.duneInput??m.duneQueryId??p?.dune?.sourceUrl??p?.dune?.queryId??p?.duneQueryId??"").toString().trim());if(!e){window.alert("Please provide a valid Dune URL or numeric query_id.");return}let l=n||`https://dune.com/queries/${e}${a?"/"+a:""}`,r=m.datesToShow??p?.dune?.datesToShow??4,s=m.datesColumn??p?.dune?.datesColumn??"",i=b.filter(e=>""!==e.trim());Object.assign(t,{contentType:"dune",dune:{provider:"dune",queryId:e,...a?{vizId:a}:{},sourceUrl:l,version:0,datesToShow:r,datesColumn:s,valueColumns:i},duneQueryId:(0,u.AK)()}),Object.assign(t,{text:(0,u.AK)(),imageSrc:(0,u.AK)(),lottieSrc:(0,u.AK)()})}await (0,u.pl)(e,t,{merge:!0}),i()},G=async()=>{if(o)try{let e=(0,u.JU)(A,W().concat(["overlay",o]).join("/"));await (0,u.oe)(e);let t=(0,u.JU)(A,W().join("/")),a=await (0,u.QT)(t);if(a.exists()){let e=a.data(),n=(Array.isArray(e?.layers)?[...e.layers]:[]).filter(e=>e!==o),l={};n.forEach((e,t)=>{l[e]=t}),await (0,u.pl)(t,{layers:n,zIndexMap:l},{merge:!0})}}finally{D(!1),i()}},q=({id:e,label:t})=>{let a=h===e,l=(p?.contentType??"none")===e;return n.jsx("button",{className:`px-2 py-1 text-xs border rounded${l?" bg-green-100 border-green-600 text-green-800":""}${a&&!l?" bg-gray-200":""}${a||l?"":" bg-white hover:bg-gray-50"}`,onClick:()=>g(e),children:t})};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-4 rounded-lg w-[560px] max-w-[95vw]",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("div",{className:"flex items-center gap-2 min-w-0",children:n.jsx(P,{projectId:e,canvasId:t,selectedId:o,initialName:p?.name||o})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[!R&&n.jsx("button",{className:"px-2 py-1 text-xs border rounded text-red-700 border-red-600 hover:bg-red-50",onClick:()=>D(!0),children:"Delete box"}),R&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-[11px] text-red-700",children:"Delete this box? This cannot be undone."}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-red-600 text-white",onClick:G,children:"Yes, delete"}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>D(!1),children:"No, go back"})]}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:i,children:"Close"}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-blue-600 text-white",onClick:H,children:"Save"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[n.jsx(q,{id:"background",label:"Background"}),n.jsx(q,{id:"text",label:"Text"}),n.jsx(q,{id:"image",label:"Image"}),n.jsx(q,{id:"animation",label:"Animation"}),n.jsx(q,{id:"dune",label:"Dune"})]}),(0,n.jsxs)("div",{className:"border rounded p-3 bg-gray-50",children:["background"===h&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Mode"}),(0,n.jsxs)("select",{value:m.background?.mode??p?.background?.mode??"none",onChange:e=>v({...m,background:{...m.background??{},mode:e.target.value}}),children:[n.jsx("option",{value:"none",children:"None"}),n.jsx("option",{value:"solid",children:"Solid"}),n.jsx("option",{value:"linear",children:"Linear"}),n.jsx("option",{value:"radial",children:"Radial"})]})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"From"}),n.jsx("input",{type:"color",value:m.background?.from??p?.background?.from??"#000000",onChange:e=>v({...m,background:{...m.background??{},from:e.target.value}})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"To"}),n.jsx("input",{type:"color",value:m.background?.to??p?.background?.to??"#000000",onChange:e=>v({...m,background:{...m.background??{},to:e.target.value}})})]})]}),"text"===h&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Text"}),n.jsx("input",{value:m.text??p?.text?.content??"",onChange:e=>v({...m,text:e.target.value})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Font size"}),n.jsx("input",{type:"number",value:m.fontSize??p?.text?.fontSize??18,onChange:e=>v({...m,fontSize:Number(e.target.value)})})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:m.fitToWidth??p?.text?.fitToWidth??!1,onChange:e=>v({...m,fitToWidth:e.target.checked})}),n.jsx("span",{children:"Auto fit width"})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Color"}),n.jsx("input",{type:"color",value:m.color??p?.text?.color??"#ffffff",onChange:e=>v({...m,color:e.target.value})})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:m.bold??p?.text?.bold??!1,onChange:e=>v({...m,bold:e.target.checked})}),n.jsx("span",{children:"Bold"})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Align"}),(0,n.jsxs)("select",{value:m.align??p?.text?.align??"left",onChange:e=>v({...m,align:e.target.value}),children:[n.jsx("option",{value:"left",children:"Left"}),n.jsx("option",{value:"center",children:"Center"}),n.jsx("option",{value:"right",children:"Right"})]})]})]}),"image"===h&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[n.jsx("div",{className:"text-[11px] text-gray-600",children:"Accepted formats: JPG/PNG. Max size: 1MB."}),I&&n.jsx("div",{className:"text-[11px] text-red-600",children:I}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:()=>y.current?.click(),disabled:w,children:w?"Uploading…":"Upload image"}),B&&n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:J,children:M?"Hide uploaded":"Browse uploaded"}),n.jsx("input",{ref:y,type:"file",accept:"image/jpeg,image/png,.jpg,.jpeg,.png",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&K(t),e.currentTarget.value=""}})]}),(0,n.jsxs)("label",{className:"grid gap-1 mt-2 max-w-[240px]",children:[n.jsx("span",{children:"Image behavior"}),(0,n.jsxs)("select",{value:m.imageBehavior??p?.imageBehavior??"contain",onChange:e=>v({...m,imageBehavior:e.target.value}),children:[n.jsx("option",{value:"contain",children:"contain (default)"}),n.jsx("option",{value:"cover",children:"cover"})]})]}),(m.imageSrc??p?.imageSrc??C)&&(0,n.jsxs)("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[11px] text-gray-600 mb-1",children:"Preview"}),n.jsx("div",{className:"w-[200px] h-[120px] bg-white border rounded overflow-hidden flex items-center justify-center",children:n.jsx("img",{src:m.imageSrc??p?.imageSrc??C,style:{objectFit:m.imageBehavior??p?.imageBehavior??"contain",width:"100%",height:"100%",objectPosition:"center"},alt:"preview"})})]}),M&&n.jsx("div",{className:"mt-2 border rounded p-2 bg-white max-h-[200px] overflow-auto",children:0===z.length?n.jsx("div",{className:"text-[11px] text-gray-600",children:"No uploaded images found."}):n.jsx("div",{className:"grid grid-cols-3 gap-2",children:z.map(e=>(0,n.jsxs)("button",{className:"border rounded overflow-hidden hover:ring-1 hover:ring-blue-500",onClick:()=>v({...m,imageSrc:e.url}),title:e.name,children:[n.jsx("img",{src:e.url,alt:e.name,className:"w-full h-[80px] object-cover"}),n.jsx("div",{className:"text-[10px] px-1 py-1 truncate text-left",children:e.name})]},e.id))})})]}),"animation"===h&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[n.jsx("div",{className:"text-[11px] text-gray-600",children:"Upload Lottie JSON file (max 2MB)."}),I&&n.jsx("div",{className:"text-[11px] text-red-600",children:I}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:()=>j.current?.click(),disabled:w,children:w?"Uploading…":"Upload Lottie JSON"}),n.jsx("input",{ref:j,type:"file",accept:"application/json,.json",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&X(t),e.currentTarget.value=""}})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:void 0!==m.loopEnabled?m.loopEnabled:!p?.loop||"boolean"==typeof p.loop&&p.loop,onChange:e=>{e.target.checked?v({...m,loopEnabled:!0,loop:!0}):v({...m,loopEnabled:!1,loop:!1})}}),n.jsx("span",{children:"Loop animation"})]}),(void 0!==m.loopEnabled?m.loopEnabled:!p?.loop||"boolean"==typeof p.loop&&p.loop)&&(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsxs)("select",{value:m.loopMode??"infinite",onChange:e=>{if("infinite"===e.target.value)v({...m,loop:!0,loopMode:"infinite"});else{let e=m.loopCount??3;v({...m,loop:e,loopMode:"count"})}},className:"text-xs border rounded p-1",children:[n.jsx("option",{value:"infinite",children:"Infinite"}),n.jsx("option",{value:"count",children:"Count"})]}),"count"===m.loopMode&&n.jsx("input",{type:"number",min:"1",max:"999",value:m.loopCount??3,onChange:e=>{let t=parseInt(e.target.value)||1;v({...m,loopCount:t,loop:t})},className:"text-xs border rounded p-1",placeholder:"Loop count"})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:void 0!==m.autoplay?m.autoplay:p?.autoplay??!0,onChange:e=>v({...m,autoplay:e.target.checked})}),n.jsx("span",{children:"Autoplay"})]}),(E||m.lottieSrc||p?.lottieSrc)&&(0,n.jsxs)("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[11px] text-gray-600 mb-1",children:"Preview"}),n.jsx("div",{className:"w-[100px] h-[100px] bg-white border rounded overflow-hidden flex items-center justify-center",children:n.jsx(r.ZP,{animationData:E,loop:!0,autoplay:!0,style:{width:"100%",height:"100%"},renderer:"canvas",rendererSettings:{progressiveLoad:!0,clearCanvas:!0,preserveAspectRatio:"none",dpr:1}})})]})]}),"dune"===h&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Dune URL or Query ID"}),n.jsx("input",{placeholder:"https://dune.com/queries/4880231/8081146 or 4880231",value:m.duneInput??m.duneQueryId??p?.dune?.sourceUrl??p?.dune?.queryId??p?.duneQueryId??"",onChange:e=>v({...m,duneInput:e.target.value})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:'Dates column (e.g. "week")'}),n.jsx("input",{placeholder:"week",value:m.datesColumn??p?.dune?.datesColumn??"",onChange:e=>v({...m,datesColumn:e.target.value})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Dates to show"}),n.jsx("input",{type:"number",min:"2",max:"20",placeholder:"4",value:m.datesToShow??p?.dune?.datesToShow??4,onChange:e=>v({...m,datesToShow:parseInt(e.target.value)||4})})]}),(0,n.jsxs)("div",{className:"grid gap-1",children:[n.jsx("span",{children:"Value(s) to visualize"}),b.map((e,t)=>(0,n.jsxs)("div",{className:"flex gap-1",children:[n.jsx("input",{placeholder:"e.g. total_members_all_networks",value:e,onChange:e=>{let a=[...b];a[t]=e.target.value,f(a)}}),b.length>1&&n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-red-100 text-red-700 hover:bg-red-200",onClick:()=>f(b.filter((e,a)=>a!==t)),children:"Remove"})]},t)),n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-gray-100 hover:bg-gray-200",onClick:()=>f([...b,""]),children:"+ Add another value"})]})]})]})]})})}function P({projectId:e,canvasId:t,selectedId:a,initialName:r}){let[s,i]=(0,l.useState)(!1),[o,d]=(0,l.useState)(r),c=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`},x=async n=>{let l=n.trim();if(!l){i(!1),d(r);return}let s=`${l}_${c()}`,o=(0,u.JU)((0,u.ad)(),"interoperable-canvas",e,"canvases",t,"overlay",a);await (0,u.pl)(o,{name:l,nameKey:s},{merge:!0}),i(!1)};return s?n.jsx("input",{className:"text-sm font-semibold border rounded px-1 py-0.5 min-w-0",autoFocus:!0,value:o,onChange:e=>d(e.target.value),onBlur:()=>x(o),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),x(o)),"Escape"===e.key&&(e.preventDefault(),i(!1),d(r))}}):n.jsx("button",{className:"text-sm font-semibold truncate",title:o,onClick:()=>i(!0),children:o})}var U=a(2818);let z={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},L=(0,c.C6)().length?(0,c.C6)()[0]:(0,c.ZF)(z),R=(0,u.ad)(L),D=(0,x.cF)(L);function F({projectId:e,scope:t={type:"root"},canvasId:a="root"}){let[r,s]=(0,l.useState)(t),[i,o]=(0,l.useState)([]),[c,p]=(0,l.useState)(!1),[h,g]=(0,l.useState)(!1);(0,l.useRef)(!1);let m=d(e=>e.aspect),v=d(e=>e.setAspect),b=d(e=>e.background),f=d(e=>e.setBackground);d(e=>e.layers),d(e=>e.setLayers);let N=d(e=>e.ui);d(e=>e.openLayersModal);let C=d(e=>e.closeLayersModal),k=d(e=>e.closeBackgroundModal),E="linear"===b.mode?`linear-gradient(135deg, ${b.from}, ${b.to})`:"radial"===b.mode?`radial-gradient(circle, ${b.from}, ${b.to})`:"solid"===b.mode?b.from:"zigzag"===b.mode?"zigzag":"",B=(...t)=>{if(!e)return t;let n=["interoperable-canvas",e];return"child"===r.type&&n.push("child-canvases",r.childId),n.push("canvases",a),[...n,...t]};(0,l.useRef)(!1);let $=async t=>{if(c||(f(t),!e))return;let a=(0,u.JU)(R,B().join("/"));await (0,u.pl)(a,{background:t},{merge:!0})},A=async t=>{if(c||(v(t),!e))return;let a=(0,u.JU)(R,B().join("/"));await (0,u.pl)(a,{aspect:t},{merge:!0})};(0,l.useRef)(null);let T=!c;return(0,n.jsxs)("div",{className:"min-h-screen flex bg-gray-800",children:[!c&&(0,n.jsxs)("div",{className:"fixed left-0 top-0 h-screen w-48 p-4 bg-gray-900 flex flex-col gap-3 overflow-y-auto",children:[n.jsx(U.Z,{}),(0,n.jsxs)("div",{className:T?"":"opacity-50 pointer-events-none",children:[n.jsx(j,{}),n.jsx(w,{onAspectChange:A}),(0,n.jsxs)("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Canvas Scope"}),(0,n.jsxs)("select",{value:"root"===r.type?"root":`child:${r.childId}`,onChange:e=>{let t=e.target.value;"root"===t?s({type:"root"}):t.startsWith("child:")&&s({type:"child",childId:t.split(":")[1]||"mini-app-test"})},className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",disabled:!T,children:[n.jsx("option",{value:"root",children:"Root"}),i.map(e=>(0,n.jsxs)("option",{value:`child:${e}`,children:["Child: ",e]},e))]})]}),n.jsx("button",{className:"w-full px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{if(!e||!T)return;let t=prompt("New child canvas id (e.g., mini-app-test-2)")?.trim();if(!t)return;let a=["interoperable-canvas",e,"child-canvases",t].join("/");await (0,u.pl)((0,u.JU)(R,a),{createdAt:Date.now()},{merge:!0});let n=["interoperable-canvas",e,"child-canvases",t,"canvases","root"].join("/");await (0,u.pl)((0,u.JU)(R,n),{aspect:m??"1:1",createdAt:Date.now()},{merge:!0});try{let a=`interoperable-canvas/assets/${e}/child-canvases/${t}/images/.keep`,n=new Blob(["placeholder"],{type:"text/plain"});await (0,x.KV)((0,x.iH)(D,a),n,{cacheControl:"no-store"})}catch{}s({type:"child",childId:t});try{let t=(0,u.hJ)(R,["interoperable-canvas",e,"child-canvases"].join("/")),a=await (0,u.PL)(t),n=[];a.forEach(e=>n.push(e.id)),o(n.sort())}catch{}},disabled:!T,children:"New Child Canvas"})]})]}),n.jsx("div",{className:`overflow-hidden ${c?"w-full flex justify-center":"flex-1 ml-48"}`,children:n.jsx(I,{aspect:m,backgroundColor:E,backgroundMode:b.mode,backgroundFrom:b.from,backgroundTo:b.to,presentation:c,fullscreen:h,children:n.jsx("div",{className:"w-full h-full",children:n.jsx(y,{projectId:e??"demo",scope:r,canvasId:a,presentation:c,isAuthorized:!!c||T})})})}),n.jsx(S,{open:N.showBackgroundModal,mode:b.mode,from:b.from,to:b.to,onClose:()=>k(),onSave:e=>{$(e),k()}}),n.jsx(_,{open:N.showLayersModal,onClose:()=>C(),projectId:e??"demo",canvasId:a,scope:r}),n.jsx(M,{projectId:e??"demo",canvasId:a,scope:r})]})}},2818:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var n=a(326),l=a(7577),r=a(8057);function s(){let[e,t]=(0,l.useState)(null),[a,s]=(0,l.useState)(null),[i,o]=(0,l.useState)(null),d=async()=>{try{o(null);let e=window;if(!e.ethereum){o("MetaMask not found. Please install it to connect.");return}let a=new r.Q(e.ethereum);await a.send("eth_requestAccounts",[]);let n=await a.getSigner(),l=await n.getAddress();t(l);let i=await a.getNetwork();s(i.chainId.toString())}catch(e){o(e?.message??"Failed to connect wallet")}};return(0,n.jsxs)("div",{className:"space-y-2",children:[e?(0,n.jsxs)("div",{className:"text-xs text-gray-300 break-all",children:[n.jsx("div",{children:"Connected"}),n.jsx("div",{className:"font-mono",children:e}),a&&(0,n.jsxs)("div",{className:"opacity-80",children:["Chain: ",a]}),n.jsx("button",{className:"mt-2 w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:()=>{t(null),s(null)},children:"Disconnect (local)"})]}):n.jsx("button",{className:"w-full px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",onClick:d,children:"Connect Wallet (MetaMask)"}),i&&n.jsx("div",{className:"text-[11px] text-red-400",children:i}),n.jsx("div",{className:"text-[11px] text-gray-400",children:"Note: Replace this with your preferred login method (e.g. Privy, Wagmi, RainbowKit)."})]})}},1506:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,metadata:()=>s});var n=a(9510),l=a(5384),r=a.n(l);a(7272);let s={title:"Interoperable Canvas",description:"Open-source canvas playground"};function i({children:e}){return n.jsx("html",{lang:"en",children:n.jsx("body",{className:r().className,children:e})})}},7272:()=>{}};