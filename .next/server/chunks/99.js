exports.id=99,exports.ids=[99],exports.modules={4010:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2994,23)),Promise.resolve().then(a.t.bind(a,6114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,9671,23)),Promise.resolve().then(a.t.bind(a,1868,23)),Promise.resolve().then(a.t.bind(a,4759,23))},2546:()=>{},3856:(e,t,a)=>{"use strict";a.d(t,{s:()=>R});var n=a(326),l=a(7577),r=a(7804),s=a(8408),i=a(2750);let o=(0,s.U)()((0,i.n)(e=>({aspect:"1:1",setAspect:t=>e(e=>{e.aspect=t}),background:{mode:"solid",from:"#000000",to:"#000000"},setBackground:t=>e(e=>{e.background=t}),items:[],overlay:[],setOverlay:t=>e(e=>{e.overlay=t}),layers:[{id:"background",name:"Background",z:0}],ui:{showBackgroundModal:!1,showLayersModal:!1,showBoxModal:!1,currentTool:"none"},selectedId:null,addItem:t=>e(e=>{e.items.push(t)}),updateItem:(t,a)=>e(e=>{let n=e.items.findIndex(e=>e.id===t);n>=0&&Object.assign(e.items[n],a)}),setItems:t=>e(e=>{e.items=t}),addOverlay:t=>e(e=>{e.overlay.push(t)}),updateOverlay:(t,a)=>e(e=>{let n=e.overlay.findIndex(e=>e.id===t);n>=0&&Object.assign(e.overlay[n],a)}),addLayer:t=>e(e=>{e.layers.push(t)}),setLayers:t=>e(e=>{e.layers=t}),moveLayerUp:t=>e(e=>{if("background"===t)return;let a=e.layers.findIndex(e=>e.id===t);if(a>=0&&a<e.layers.length-1){let t=e.layers[a];e.layers[a]=e.layers[a+1],e.layers[a+1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),moveLayerDown:t=>e(e=>{let a=e.layers.findIndex(e=>e.id===t);if(a>0){if(e.layers[a-1]?.id==="background")return;let t=e.layers[a];e.layers[a]=e.layers[a-1],e.layers[a-1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),openBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!0}),closeBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!1}),openLayersModal:()=>e(e=>{e.ui.showLayersModal=!0}),closeLayersModal:()=>e(e=>{e.ui.showLayersModal=!1}),setTool:t=>e(e=>{e.ui.currentTool=t}),setSelectedId:t=>e(e=>{e.selectedId=t}),openBoxModal:t=>e(e=>{e.selectedId=t,e.ui.showBoxModal=!0}),closeBoxModal:()=>e(e=>{e.ui.showBoxModal=!1}),createBox:t=>{let a=t.id;if(!a){let e=Math.random().toString(36).slice(2,7);a=`box_${Date.now()}_${e}`}let n=Math.max(16,Math.round(t.w)),l=Math.max(16,Math.round(t.h));return e(e=>{let r=e.layers.length;e.overlay.push({id:a,x:Math.round(t.x),y:Math.round(t.y),w:n,h:l,contentType:t.contentType??"none"}),e.layers.push({id:a,name:t.name??a,z:r}),e.ui.currentTool="none",e.selectedId=a}),a}})));var d=a(2585),c=a(76);let u={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},x=(0,d.C6)().length?(0,d.C6)()[0]:(0,d.ZF)(u),h=(0,c.ad)(x);function g({projectId:e="demo",canvasId:t="root",scope:a={type:"root"}}){let s=o(e=>e.overlay);o(e=>e.setOverlay);let i=o(e=>e.updateOverlay),d=o(e=>e.layers);o(e=>e.setLayers);let u=o(e=>e.createBox),x=o(e=>e.ui.currentTool),g=o(e=>e.setTool),m=o(e=>e.openBoxModal),v=(0,l.useRef)(null),[b,y]=(0,l.useState)(null),[f,j]=(0,l.useState)(null),N=o(e=>e.selectedId),w=o(e=>e.setSelectedId),I=(0,l.useMemo)(()=>{let e={};return d.forEach(t=>{e[t.id]=t.z}),e},[d]),S=()=>{let n=["interoperable-canvas",e];return a?.type==="child"&&n.push("child-canvases",a.childId),n.push("canvases",t),n};return(0,n.jsxs)("div",{ref:v,className:"w-full h-full absolute inset-0",style:{zIndex:1},onPointerDown:e=>{if("add-box"!==x)return;let t=v.current?.getBoundingClientRect();if(!t)return;let a=e.clientX-t.left,n=e.clientY-t.top;y({x:a,y:n}),j({x:a,y:n,w:0,h:0})},onPointerMove:e=>{if("add-box"!==x||!b)return;let t=v.current?.getBoundingClientRect();if(!t)return;let a=e.clientX-t.left,n=e.clientY-t.top,l=Math.min(b.x,a);j({x:l,y:Math.min(b.y,n),w:Math.abs(a-b.x),h:Math.abs(n-b.y)})},onPointerUp:()=>{if("add-box"!==x||!b||!f)return;let e=Math.max(40,f.w),t=Math.max(40,f.h),a=u({x:f.x,y:f.y,w:e,h:t}),n=(0,c.JU)(h,S().concat(["overlay",a]).join("/")),l=(Array.isArray(s)?s.length:0)+1,r=`Box ${l}`,i=`${r}_${(()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`})()}`;(0,c.pl)(n,{id:a,x:Math.round(f.x),y:Math.round(f.y),w:e,h:t,contentType:"none",name:r,nameKey:i},{merge:!0}),w(a),y(null),j(null),g("none")},children:[s.map(e=>n.jsx(r.s,{size:{width:e.w,height:e.h},position:{x:e.x,y:e.y},onDragStop:(t,a)=>{let n=Math.round(a.x),l=Math.round(a.y);i(e.id,{x:n,y:l});let r=(0,c.JU)(h,S().concat(["overlay",e.id]).join("/"));(0,c.pl)(r,{x:n,y:l},{merge:!0})},onResizeStop:(t,a,n,l,r)=>{let s=Math.round(n.offsetWidth),o=Math.round(n.offsetHeight),d=Math.round(r.x),u=Math.round(r.y);i(e.id,{w:s,h:o,x:d,y:u});let x=(0,c.JU)(h,S().concat(["overlay",e.id]).join("/"));(0,c.pl)(x,{w:s,h:o,x:d,y:u},{merge:!0})},bounds:"parent",style:{border:e.id===N?"2px solid #ffcf33":"1px solid rgba(255,255,255,0.25)",background:(()=>{let t=e.background;return t&&"none"!==t.mode?"solid"===t.mode?t.from??"#000000":"linear"===t.mode?`linear-gradient(135deg, ${t.from??"#000000"}, ${t.to??"#000000"})`:"radial"===t.mode?`radial-gradient(circle, ${t.from??"#000000"}, ${t.to??"#000000"})`:"transparent":"transparent"})(),borderRadius:8,overflow:"hidden",zIndex:I[e.id]??1},onClick:()=>w(e.id),onDoubleClick:()=>m(e.id),children:(0,n.jsxs)("div",{className:"w-full h-full",children:["text"===e.contentType&&n.jsx(p,{text:e.text?.content??"",color:e.text?.color??"#ffffff",bold:!!e.text?.bold,align:e.text?.align??"left",fitToWidth:!!e.text?.fitToWidth,baseFontSize:e.text?.fontSize??18}),"image"===e.contentType&&e.imageSrc&&n.jsx("img",{src:e.imageSrc,alt:"",style:{width:"100%",height:"100%",objectFit:e.imageBehavior??"contain",objectPosition:"center"}})]})},e.id)),"add-box"===x&&f&&n.jsx("div",{className:"absolute border-2 border-blue-400/70 bg-blue-400/10",style:{left:f.x,top:f.y,width:f.w,height:f.h,pointerEvents:"none"}})]})}function p({text:e,color:t,bold:a,align:r,fitToWidth:s,baseFontSize:i}){let o=(0,l.useRef)(null),[d,c]=(0,l.useState)(i),[u,x]=(0,l.useState)(1.2);return n.jsx("div",{ref:o,style:{color:t,fontSize:d,fontWeight:a?700:400,lineHeight:u,display:"flex",alignItems:"center",justifyContent:"left"===r?"flex-start":"center"===r?"center":"flex-end",width:"100%",height:"100%",padding:8,textAlign:r,wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:e})}function m({projectId:e="demo",scope:t={type:"root"},canvasId:a="root"}){return n.jsx("div",{className:"w-full h-full relative",children:n.jsx(g,{projectId:e,canvasId:a,scope:t})})}function v(){let e=o(e=>e.openBackgroundModal),t=o(e=>e.setTool);return(0,n.jsxs)("div",{className:"space-y-2 relative",children:[n.jsx("button",{className:"w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>t("add-box"),children:"Add Box"}),n.jsx("button",{className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>e(),children:"Background"}),n.jsx("button",{className:"w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:o.getState().openLayersModal,children:"Layers"})]})}function b({onAspectChange:e}){let{aspect:t,setAspect:a}=o(),l=t=>{a(t),e?.(t)};return(0,n.jsxs)("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Aspect Ratio"}),(0,n.jsxs)("select",{value:t,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",children:[n.jsx("option",{value:"16:9",children:"16:9 (Widescreen)"}),n.jsx("option",{value:"4:3",children:"4:3 (Standard)"}),n.jsx("option",{value:"1:1",children:"1:1 (Square)"}),n.jsx("option",{value:"4:6",children:"4:6 (Vertical Post)"}),n.jsx("option",{value:"9:16",children:"9:16 (Vertical Stories)"}),n.jsx("option",{value:"mini-app",children:"Mini App (9:16 safe)"})]})]})}function y({aspect:e,backgroundColor:t,className:a="",children:l,presentation:r=!1}){let s=()=>{switch(e){case"1:1":default:return"aspect-square";case"16:9":return"aspect-video";case"4:3":return"aspect-[4/3]";case"9:16":case"mini-app":return"aspect-[9/16]";case"4:6":return"aspect-[4/6]"}},i=()=>"1:1"===e?`${s()} h-[95%] max-w-full mx-[10px]`:"16:9"===e?`${s()} w-full max-h-full mx-[20px]`:"4:3"===e?`${s()} h-[95%] max-w-full mx-[20px]`:`${s()} h-[95%] max-w-full mx-[10px]`;return"mini-app"===e?n.jsx("div",{className:`w-full h-screen flex items-center justify-center ${a}`,children:n.jsx("div",{className:i(),children:(0,n.jsxs)("div",{className:"w-full h-full relative overflow-hidden",style:{background:t||"transparent"},children:[!r&&n.jsx("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:0,height:"10%",background:"#ffffff",borderBottom:"1px solid rgba(0,0,0,0.08)",pointerEvents:"none",zIndex:2}}),n.jsx("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:r?"0%":"10%",bottom:"2.5%"},children:n.jsx("div",{className:"w-full h-full relative",style:{zIndex:1},children:l})})]})})}):n.jsx("div",{className:`w-full h-screen flex items-center justify-center ${a}`,children:n.jsx("div",{className:i(),children:n.jsx("div",{className:"w-full h-full relative overflow-hidden",style:{background:t||"transparent"},children:l})})})}function f({open:e,mode:t,from:a,to:r,onClose:s,onSave:i}){let[o,d]=(0,l.useState)(t??"linear"),[c,u]=(0,l.useState)(a),[x,h]=(0,l.useState)(r),g=(0,l.useMemo)(()=>"solid"===o?c:"linear"===o?`linear-gradient(135deg, ${c}, ${x})`:"radial"===o?`radial-gradient(circle, ${c}, ${x})`:"transparent",[o,c,x]);return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[n.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Background"}),(0,n.jsxs)("div",{className:"space-y-4",children:[n.jsx("div",{className:"h-24 rounded",style:{background:g}}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:"Type"}),(0,n.jsxs)("select",{className:"w-full px-3 py-2 border rounded",value:o,onChange:e=>d(e.target.value),children:[n.jsx("option",{value:"none",children:"No background"}),n.jsx("option",{value:"solid",children:"Solid"}),n.jsx("option",{value:"linear",children:"Linear gradient"}),n.jsx("option",{value:"radial",children:"Radial gradient"})]})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:"From Color"}),n.jsx("input",{type:"color",value:c,onChange:e=>u(e.target.value),className:"w-full h-10 border rounded"})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:"To Color"}),n.jsx("input",{type:"color",value:x,onChange:e=>h(e.target.value),className:"w-full h-10 border rounded"})]})]}),(0,n.jsxs)("div",{className:"flex gap-2 mt-6",children:[n.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"}),n.jsx("button",{onClick:()=>{"none"===o?i({mode:"none",from:"transparent",to:"transparent"}):"solid"===o?i({mode:"solid",from:c,to:c}):"linear"===o?i({mode:"linear",from:c,to:x}):"radial"===o&&i({mode:"radial",from:c,to:x})},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"})]})]})}):null}let j={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},N=(0,d.C6)().length?(0,d.C6)()[0]:(0,d.ZF)(j),w=(0,c.ad)(N);function I({open:e,onClose:t,projectId:a,canvasId:r="root",scope:s={type:"root"}}){let i=o(e=>e.layers),d=o(e=>e.overlay),u=o(e=>e.moveLayerUp),x=o(e=>e.moveLayerDown),h=o(e=>e.selectedId),g=o(e=>e.setSelectedId),[p,m]=(0,l.useState)(null),[v,b]=(0,l.useState)(""),y=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`},f=()=>{let e=["interoperable-canvas",a];return s?.type==="child"&&e.push("child-canvases",s.childId),e.push("canvases",r),e},j=async(e,t)=>{if(!t.trim()||!a){m(null);return}let n=`${t.trim()}_${y()}`,l=(0,c.JU)(w,f().concat(["overlay",e]).join("/"));await (0,c.pl)(l,{name:t.trim(),nameKey:n},{merge:!0}),m(null)};return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Layers"}),n.jsx("button",{onClick:t,className:"px-3 py-1 border rounded hover:bg-gray-50",children:"Close"})]}),(0,n.jsxs)("div",{className:"space-y-2 max-h-80 overflow-auto",children:[0===i.length&&n.jsx("div",{className:"text-sm text-gray-500",children:"No layers yet. Add items to populate."}),[...i].sort((e,t)=>t.z-e.z).map(e=>(0,n.jsxs)("div",{className:`flex items-center justify-between border rounded px-3 py-2 ${h===e.id?"bg-gray-100":""}`,onClick:()=>"background"!==e.id&&g(e.id),children:[n.jsx("div",{className:"truncate",children:p===e.id?n.jsx("input",{className:"text-sm border rounded px-1 py-0.5 w-40",autoFocus:!0,value:v,onChange:e=>b(e.target.value),onKeyDown:t=>{let a=d.find(t=>t.id===e.id)?.name||e.name||e.id;"Enter"===t.key&&(t.preventDefault(),j(e.id,v||a)),"Escape"===t.key&&m(null)},onBlur:()=>{let t=d.find(t=>t.id===e.id)?.name||e.name||e.id;j(e.id,v||t)}}):n.jsx("button",{className:"font-medium text-left truncate",onClick:t=>{t.stopPropagation();let a=d.find(t=>t.id===e.id)?.name||e.name||e.id;m(e.id),b(a)},children:d.find(t=>t.id===e.id)?.name||e.name||e.id})}),(0,n.jsxs)("div",{className:"flex gap-1",children:["background"!==e.id&&n.jsx("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Up",onClick:t=>{t.stopPropagation(),u(e.id)},children:"▲"}),"background"!==e.id&&e.z>1&&n.jsx("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Down",onClick:t=>{t.stopPropagation(),x(e.id)},children:"▼"})]})]},e.id))]})]})}):null}var S=a(1552);let E={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},C=(0,d.C6)().length?(0,d.C6)()[0]:(0,d.ZF)(E),k=(0,c.ad)(C),_=(0,S.cF)(C);function B({projectId:e="demo",canvasId:t="root",scope:a={type:"root"}}){let r=o(e=>e.ui.showBoxModal),s=o(e=>e.closeBoxModal),i=o(e=>e.selectedId),d=o(e=>e.overlay),u=(0,l.useMemo)(()=>d.find(e=>e.id===i),[d,i]),[x,h]=(0,l.useState)("background"),[g,p]=(0,l.useState)({}),m=(0,l.useRef)(null),[v,b]=(0,l.useState)(!1),[y,f]=(0,l.useState)(null),[j,N]=(0,l.useState)(null),[w,I]=(0,l.useState)(!1),[E,C]=(0,l.useState)(!1),[B,M]=(0,l.useState)([]),[T,$]=(0,l.useState)(!1),P=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`},U=async()=>{try{let t=(0,c.hJ)(k,"interoperable-canvas",e,"images"),a=await (0,c.PL)(t),n=[];for(let e of a.docs){let t=e.data(),a=t?.storagePath,l=t?.filename??e.id;if(a)try{let t=(0,S.iH)(_,a),r=await (0,S.Jt)(t);n.push({id:e.id,name:l,url:r})}catch{}}M(n)}catch{M([])}};if(!r||!i)return null;let R=async t=>{if(f(null),t){if(!("image/jpeg"===t.type||"image/png"===t.type)){f("Only JPG or PNG files are accepted.");return}if(t.size>1048576){f("Maximum size is 1MB.");return}b(!0);try{let n=t.name,l=n.lastIndexOf("."),r=l>-1?n.slice(0,l):n,s=l>-1?n.slice(l+1):"jpg",i=`${r}_${P()}.${s}`,o=a?.type==="child"?`interoperable-canvas/assets/${e}/child-canvases/${a.childId}/images/${i}`:`interoperable-canvas/assets/${e}/images/${i}`,d=(0,S.iH)(_,o);await (0,S.KV)(d,t,{contentType:t.type,cacheControl:"public, max-age=31536000, immutable"});let x=await (0,S.Jt)(d),h=URL.createObjectURL(t);N(h);let m=await new Promise(e=>{let t=new Image;t.onload=()=>{e({width:t.naturalWidth,height:t.naturalHeight}),URL.revokeObjectURL(h)},t.src=h}),v=(0,c.JU)(k,"interoperable-canvas",e,"images",i);await (0,c.pl)(v,{filename:i,originalName:n,storagePath:o,mimeType:t.type,sizeBytes:t.size,width:m.width,height:m.height,uploadedAt:(0,c.Bt)()},{merge:!0}),p({...g,imageSrc:x,imageBehavior:g.imageBehavior??u?.imageBehavior??"contain"}),I(!0)}catch(e){f("Upload failed. Please try again.")}finally{b(!1)}}},L=async()=>{let e=!E;C(e),e&&0===B.length&&await U()},D=()=>{let n=["interoperable-canvas",e];return a?.type==="child"&&n.push("child-canvases",a.childId),n.push("canvases",t),n},F=async()=>{if(!i)return;let e=(0,c.JU)(k,D().concat(["overlay",i]).join("/")),t={};"background"===x&&(t.background=g.background??{mode:"none"});let a="text"===x?"text":"image"===x?"image":"animation"===x?"animation":"dune"===x?"dune":null;if(a&&u?.contentType&&u.contentType!==a){let e={text:"text",image:"image",animation:"animation",dune:"dune"},t=e[u.contentType]??null;if(t&&!window.confirm(`You can only add one asset per box. Adding ${e[a]} will remove ${t}. Continue?`))return}if("text"===x&&(t.contentType="text",t.text={content:g.text??u?.text?.content??"",fontSize:void 0!==g.fontSize?Number(g.fontSize):u?.text?.fontSize??18,color:g.color??u?.text?.color??"#ffffff",bold:void 0!==g.bold?!!g.bold:u?.text?.bold??!1,align:g.align??u?.text?.align??"left",fitToWidth:void 0!==g.fitToWidth?!!g.fitToWidth:u?.text?.fitToWidth??!1},Object.assign(t,{imageSrc:(0,c.AK)(),lottieSrc:(0,c.AK)(),duneQueryId:(0,c.AK)()})),"image"===x){let e=g.imageSrc??u?.imageSrc;if(!e){window.alert("Please upload or select an image before saving.");return}Object.assign(t,{contentType:"image",imageSrc:e,imageBehavior:g.imageBehavior??u?.imageBehavior??"contain"}),Object.assign(t,{text:(0,c.AK)(),lottieSrc:(0,c.AK)(),duneQueryId:(0,c.AK)()})}"animation"===x&&(Object.assign(t,{contentType:"animation",lottieSrc:g.lottieSrc}),Object.assign(t,{text:(0,c.AK)(),imageSrc:(0,c.AK)(),duneQueryId:(0,c.AK)()})),"dune"===x&&(Object.assign(t,{contentType:"dune",duneQueryId:g.duneQueryId}),Object.assign(t,{text:(0,c.AK)(),imageSrc:(0,c.AK)(),lottieSrc:(0,c.AK)()})),await (0,c.pl)(e,t,{merge:!0}),s()},z=async()=>{if(i)try{let e=(0,c.JU)(k,D().concat(["overlay",i]).join("/"));await (0,c.oe)(e);let t=(0,c.JU)(k,D().join("/")),a=await (0,c.QT)(t);if(a.exists()){let e=a.data(),n=(Array.isArray(e?.layers)?[...e.layers]:[]).filter(e=>e!==i),l={};n.forEach((e,t)=>{l[e]=t}),await (0,c.pl)(t,{layers:n,zIndexMap:l},{merge:!0})}}finally{$(!1),s()}},K=({id:e,label:t})=>{let a=x===e,l=(u?.contentType??"none")===e;return n.jsx("button",{className:`px-2 py-1 text-xs border rounded${l?" bg-green-100 border-green-600 text-green-800":""}${a&&!l?" bg-gray-200":""}${a||l?"":" bg-white hover:bg-gray-50"}`,onClick:()=>h(e),children:t})};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-4 rounded-lg w-[560px] max-w-[95vw]",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("div",{className:"flex items-center gap-2 min-w-0",children:n.jsx(A,{projectId:e,canvasId:t,selectedId:i,initialName:u?.name||i})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[!T&&n.jsx("button",{className:"px-2 py-1 text-xs border rounded text-red-700 border-red-600 hover:bg-red-50",onClick:()=>$(!0),children:"Delete box"}),T&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-[11px] text-red-700",children:"Delete this box? This cannot be undone."}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-red-600 text-white",onClick:z,children:"Yes, delete"}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>$(!1),children:"No, go back"})]}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:s,children:"Close"}),n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-blue-600 text-white",onClick:F,children:"Save"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[n.jsx(K,{id:"background",label:"Background"}),n.jsx(K,{id:"text",label:"Text"}),n.jsx(K,{id:"image",label:"Image"}),n.jsx(K,{id:"animation",label:"Animation"}),n.jsx(K,{id:"dune",label:"Dune"})]}),(0,n.jsxs)("div",{className:"border rounded p-3 bg-gray-50",children:["background"===x&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Mode"}),(0,n.jsxs)("select",{value:g.background?.mode??u?.background?.mode??"none",onChange:e=>p({...g,background:{...g.background??{},mode:e.target.value}}),children:[n.jsx("option",{value:"none",children:"None"}),n.jsx("option",{value:"solid",children:"Solid"}),n.jsx("option",{value:"linear",children:"Linear"}),n.jsx("option",{value:"radial",children:"Radial"})]})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"From"}),n.jsx("input",{type:"color",value:g.background?.from??u?.background?.from??"#000000",onChange:e=>p({...g,background:{...g.background??{},from:e.target.value}})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"To"}),n.jsx("input",{type:"color",value:g.background?.to??u?.background?.to??"#000000",onChange:e=>p({...g,background:{...g.background??{},to:e.target.value}})})]})]}),"text"===x&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Text"}),n.jsx("input",{value:g.text??u?.text?.content??"",onChange:e=>p({...g,text:e.target.value})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Font size"}),n.jsx("input",{type:"number",value:g.fontSize??u?.text?.fontSize??18,onChange:e=>p({...g,fontSize:Number(e.target.value)})})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:g.fitToWidth??u?.text?.fitToWidth??!1,onChange:e=>p({...g,fitToWidth:e.target.checked})}),n.jsx("span",{children:"Auto fit width"})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Color"}),n.jsx("input",{type:"color",value:g.color??u?.text?.color??"#ffffff",onChange:e=>p({...g,color:e.target.value})})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:g.bold??u?.text?.bold??!1,onChange:e=>p({...g,bold:e.target.checked})}),n.jsx("span",{children:"Bold"})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Align"}),(0,n.jsxs)("select",{value:g.align??u?.text?.align??"left",onChange:e=>p({...g,align:e.target.value}),children:[n.jsx("option",{value:"left",children:"Left"}),n.jsx("option",{value:"center",children:"Center"}),n.jsx("option",{value:"right",children:"Right"})]})]})]}),"image"===x&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[n.jsx("div",{className:"text-[11px] text-gray-600",children:"Accepted formats: JPG/PNG. Max size: 1MB."}),y&&n.jsx("div",{className:"text-[11px] text-red-600",children:y}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:()=>m.current?.click(),disabled:v,children:v?"Uploading…":"Upload image"}),w&&n.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:L,children:E?"Hide uploaded":"Browse uploaded"}),n.jsx("input",{ref:m,type:"file",accept:"image/jpeg,image/png,.jpg,.jpeg,.png",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&R(t),e.currentTarget.value=""}})]}),(0,n.jsxs)("label",{className:"grid gap-1 mt-2 max-w-[240px]",children:[n.jsx("span",{children:"Image behavior"}),(0,n.jsxs)("select",{value:g.imageBehavior??u?.imageBehavior??"contain",onChange:e=>p({...g,imageBehavior:e.target.value}),children:[n.jsx("option",{value:"contain",children:"contain (default)"}),n.jsx("option",{value:"cover",children:"cover"})]})]}),(g.imageSrc??u?.imageSrc??j)&&(0,n.jsxs)("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[11px] text-gray-600 mb-1",children:"Preview"}),n.jsx("div",{className:"w-[200px] h-[120px] bg-white border rounded overflow-hidden flex items-center justify-center",children:n.jsx("img",{src:g.imageSrc??u?.imageSrc??j,style:{objectFit:g.imageBehavior??u?.imageBehavior??"contain",width:"100%",height:"100%",objectPosition:"center"},alt:"preview"})})]}),E&&n.jsx("div",{className:"mt-2 border rounded p-2 bg-white max-h-[200px] overflow-auto",children:0===B.length?n.jsx("div",{className:"text-[11px] text-gray-600",children:"No uploaded images found."}):n.jsx("div",{className:"grid grid-cols-3 gap-2",children:B.map(e=>(0,n.jsxs)("button",{className:"border rounded overflow-hidden hover:ring-1 hover:ring-blue-500",onClick:()=>p({...g,imageSrc:e.url}),title:e.name,children:[n.jsx("img",{src:e.url,alt:e.name,className:"w-full h-[80px] object-cover"}),n.jsx("div",{className:"text-[10px] px-1 py-1 truncate text-left",children:e.name})]},e.id))})})]}),"animation"===x&&n.jsx("div",{className:"grid gap-2 text-xs",children:(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Lottie JSON URL"}),n.jsx("input",{value:g.lottieSrc??u?.lottieSrc??"",onChange:e=>p({...g,lottieSrc:e.target.value})})]})}),"dune"===x&&n.jsx("div",{className:"grid gap-2 text-xs",children:(0,n.jsxs)("label",{className:"grid gap-1",children:[n.jsx("span",{children:"Dune Query ID"}),n.jsx("input",{value:g.duneQueryId??u?.duneQueryId??"",onChange:e=>p({...g,duneQueryId:e.target.value})})]})})]})]})})}function A({projectId:e,canvasId:t,selectedId:a,initialName:r}){let[s,i]=(0,l.useState)(!1),[o,d]=(0,l.useState)(r),u=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),a=e.getFullYear(),n=t(e.getMonth()+1),l=t(e.getDate()),r=t(e.getHours()),s=t(e.getMinutes()),i=t(e.getSeconds());return`${a}${n}${l}${r}${s}${i}`},x=async n=>{let l=n.trim();if(!l){i(!1),d(r);return}let s=`${l}_${u()}`,o=(0,c.JU)((0,c.ad)(),"interoperable-canvas",e,"canvases",t,"overlay",a);await (0,c.pl)(o,{name:l,nameKey:s},{merge:!0}),i(!1)};return s?n.jsx("input",{className:"text-sm font-semibold border rounded px-1 py-0.5 min-w-0",autoFocus:!0,value:o,onChange:e=>d(e.target.value),onBlur:()=>x(o),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),x(o)),"Escape"===e.key&&(e.preventDefault(),i(!1),d(r))}}):n.jsx("button",{className:"text-sm font-semibold truncate",title:o,onClick:()=>i(!0),children:o})}var M=a(2818);let T={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID},$=(0,d.C6)().length?(0,d.C6)()[0]:(0,d.ZF)(T),P=(0,c.ad)($),U=(0,S.cF)($);function R({projectId:e,scope:t={type:"root"},canvasId:a="root"}){let[r,s]=(0,l.useState)(t),[i,d]=(0,l.useState)([]),u=o(e=>e.aspect),x=o(e=>e.setAspect),h=o(e=>e.background),g=o(e=>e.setBackground);o(e=>e.layers),o(e=>e.setLayers);let p=o(e=>e.ui);o(e=>e.openLayersModal);let j=o(e=>e.closeLayersModal),N=o(e=>e.closeBackgroundModal),w="linear"===h.mode?`linear-gradient(135deg, ${h.from}, ${h.to})`:"radial"===h.mode?`radial-gradient(circle, ${h.from}, ${h.to})`:"solid"===h.mode?h.from:"",E=(...t)=>{if(!e)return t;let n=["interoperable-canvas",e];return"child"===r.type&&n.push("child-canvases",r.childId),n.push("canvases",a),[...n,...t]},C=async t=>{if(g(t),!e)return;let a=(0,c.JU)(P,E().join("/"));await (0,c.pl)(a,{background:t},{merge:!0})},k=async t=>{if(x(t),!e)return;let a=(0,c.JU)(P,E().join("/"));await (0,c.pl)(a,{aspect:t},{merge:!0})};return(0,l.useRef)(null),(0,n.jsxs)("div",{className:"min-h-screen flex bg-gray-800",children:[(0,n.jsxs)("div",{className:"w-48 p-4 bg-gray-900 flex flex-col gap-3",children:[n.jsx(M.Z,{}),n.jsx(v,{}),n.jsx(b,{onAspectChange:k}),(0,n.jsxs)("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Canvas Scope"}),(0,n.jsxs)("select",{value:"root"===r.type?"root":`child:${r.childId}`,onChange:e=>{let t=e.target.value;"root"===t?s({type:"root"}):t.startsWith("child:")&&s({type:"child",childId:t.split(":")[1]||"mini-app-test"})},className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",children:[n.jsx("option",{value:"root",children:"Root"}),i.map(e=>(0,n.jsxs)("option",{value:`child:${e}`,children:["Child: ",e]},e))]})]}),n.jsx("button",{className:"w-full px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",onClick:async()=>{if(!e)return;let t=prompt("New child canvas id (e.g., mini-app-test-2)")?.trim();if(!t)return;let a=["interoperable-canvas",e,"child-canvases",t].join("/");await (0,c.pl)((0,c.JU)(P,a),{createdAt:Date.now()},{merge:!0});let n=["interoperable-canvas",e,"child-canvases",t,"canvases","root"].join("/");await (0,c.pl)((0,c.JU)(P,n),{aspect:u??"1:1",createdAt:Date.now()},{merge:!0});try{let a=`interoperable-canvas/assets/${e}/child-canvases/${t}/images/.keep`,n=new Blob(["placeholder"],{type:"text/plain"});await (0,S.KV)((0,S.iH)(U,a),n,{cacheControl:"no-store"})}catch{}s({type:"child",childId:t});try{let t=(0,c.hJ)(P,["interoperable-canvas",e,"child-canvases"].join("/")),a=await (0,c.PL)(t),n=[];a.forEach(e=>n.push(e.id)),d(n.sort())}catch{}},children:"New Child Canvas"})]}),n.jsx("div",{className:"flex-1 overflow-hidden",children:n.jsx(y,{aspect:u,backgroundColor:w,children:n.jsx("div",{className:"w-full h-full",children:n.jsx(m,{projectId:e??"demo",scope:r,canvasId:a})})})}),n.jsx(f,{open:p.showBackgroundModal,mode:h.mode,from:h.from,to:h.to,onClose:()=>N(),onSave:e=>{C(e),N()}}),n.jsx(I,{open:p.showLayersModal,onClose:()=>j(),projectId:e??"demo",canvasId:a,scope:r}),n.jsx(B,{projectId:e??"demo",canvasId:a,scope:r})]})}},2818:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var n=a(326),l=a(7577),r=a(8057);function s(){let[e,t]=(0,l.useState)(null),[a,s]=(0,l.useState)(null),[i,o]=(0,l.useState)(null),d=async()=>{try{o(null);let e=window;if(!e.ethereum){o("MetaMask not found. Please install it to connect.");return}let a=new r.Q(e.ethereum);await a.send("eth_requestAccounts",[]);let n=await a.getSigner(),l=await n.getAddress();t(l);let i=await a.getNetwork();s(i.chainId.toString())}catch(e){o(e?.message??"Failed to connect wallet")}};return(0,n.jsxs)("div",{className:"space-y-2",children:[e?(0,n.jsxs)("div",{className:"text-xs text-gray-300 break-all",children:[n.jsx("div",{children:"Connected"}),n.jsx("div",{className:"font-mono",children:e}),a&&(0,n.jsxs)("div",{className:"opacity-80",children:["Chain: ",a]}),n.jsx("button",{className:"mt-2 w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:()=>{t(null),s(null)},children:"Disconnect (local)"})]}):n.jsx("button",{className:"w-full px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",onClick:d,children:"Connect Wallet (MetaMask)"}),i&&n.jsx("div",{className:"text-[11px] text-red-400",children:i}),n.jsx("div",{className:"text-[11px] text-gray-400",children:"Note: Replace this with your preferred login method (e.g. Privy, Wagmi, RainbowKit)."})]})}},1506:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,metadata:()=>s});var n=a(9510),l=a(5384),r=a.n(l);a(7272);let s={title:"Interoperable Canvas",description:"Open-source canvas playground"};function i({children:e}){return n.jsx("html",{lang:"en",children:n.jsx("body",{className:r().className,children:e})})}},7272:()=>{}};