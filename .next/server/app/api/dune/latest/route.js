"use strict";(()=>{var e={};e.id=541,e.ids=[541],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4364:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>l});var s=r(9303),n=r(8716),o=r(670);let i=new Map,u=e=>process.env?.[e],p=e=>new Date(e).getTime(),d=(e,t)=>`latest:${e}:${t??""}`;async function l(e){try{let{searchParams:t}=new URL(e.url),r=(t.get("queryId")||"").trim(),a=t.get("params");if(!r||!/^\d+$/.test(r))return new Response(JSON.stringify({ok:!1,error:"invalid-queryId"}),{status:400});let s=u("DUNE_API_KEY");if(!s)return new Response(JSON.stringify({ok:!1,error:"server-misconfigured",detail:"Missing DUNE_API_KEY"}),{status:500});let n=d(r,a),o=Date.now(),l=i.get(n);if(l&&l.expiresAtMs>o)return new Response(JSON.stringify({ok:!0,source:"cache",data:l.payload}),{status:200,headers:{"content-type":"application/json"}});let c=await fetch(`https://api.dune.com/api/v1/query/${encodeURIComponent(r)}/results`,{headers:{accept:"application/json","X-Dune-API-Key":s},next:{revalidate:60}});if(!c.ok){let e=await c.text();return new Response(JSON.stringify({ok:!1,error:"upstream",status:c.status,body:e}),{status:502})}let m=await c.json(),g=m?.expires_at||m?.result?.metadata?.expires_at,y=g?p(g):o+216e5;return i.set(n,{expiresAtMs:y,payload:m}),new Response(JSON.stringify({ok:!0,source:"upstream",data:m,expiresAt:g}),{status:200,headers:{"content-type":"application/json"}})}catch(e){return console.error("dune/latest error",e),new Response(JSON.stringify({ok:!1,error:"internal-error"}),{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/dune/latest/route",pathname:"/api/dune/latest",filename:"route",bundlePath:"app/api/dune/latest/route"},resolvedPagePath:"/Users/armandoorellana/Documents/GitHub/interoperable-canvas/app/api/dune/latest/route.ts",nextConfigOutput:"export",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:y}=c,f="/api/dune/latest/route";function x(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},9303:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948],()=>r(4364));module.exports=a})();