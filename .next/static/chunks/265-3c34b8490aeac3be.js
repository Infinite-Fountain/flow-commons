"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{5265:function(e,t,l){l.d(t,{s:function(){return q}});var n=l(7437),a=l(2265),o=l(3393),i=l.n(o),r=l(2006),d=l(903),s=l(2844);let c=(0,d.U)()((0,s.n)(e=>({aspect:"1:1",setAspect:t=>e(e=>{e.aspect=t}),background:{mode:"solid",from:"#000000",to:"#000000"},setBackground:t=>e(e=>{e.background=t}),items:[],overlay:[],setOverlay:t=>e(e=>{e.overlay=t}),layers:[{id:"background",name:"Background",z:0}],ui:{showBackgroundModal:!1,showLayersModal:!1,showBoxModal:!1,currentTool:"none"},selectedId:null,addItem:t=>e(e=>{e.items.push(t)}),updateItem:(t,l)=>e(e=>{let n=e.items.findIndex(e=>e.id===t);n>=0&&Object.assign(e.items[n],l)}),setItems:t=>e(e=>{e.items=t}),addOverlay:t=>e(e=>{e.overlay.push(t)}),updateOverlay:(t,l)=>e(e=>{let n=e.overlay.findIndex(e=>e.id===t);n>=0&&Object.assign(e.overlay[n],l)}),addLayer:t=>e(e=>{e.layers.push(t)}),setLayers:t=>e(e=>{e.layers=t}),moveLayerUp:t=>e(e=>{if("background"===t)return;let l=e.layers.findIndex(e=>e.id===t);if(l>=0&&l<e.layers.length-1){let t=e.layers[l];e.layers[l]=e.layers[l+1],e.layers[l+1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),moveLayerDown:t=>e(e=>{let l=e.layers.findIndex(e=>e.id===t);if(l>0){var n;if((null===(n=e.layers[l-1])||void 0===n?void 0:n.id)==="background")return;let t=e.layers[l];e.layers[l]=e.layers[l-1],e.layers[l-1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),openBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!0}),closeBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!1}),openLayersModal:()=>e(e=>{e.ui.showLayersModal=!0}),closeLayersModal:()=>e(e=>{e.ui.showLayersModal=!1}),setTool:t=>e(e=>{e.ui.currentTool=t}),setSelectedId:t=>e(e=>{e.selectedId=t}),openBoxModal:t=>e(e=>{e.selectedId=t,e.ui.showBoxModal=!0}),closeBoxModal:()=>e(e=>{e.ui.showBoxModal=!1}),createBox:t=>{let l=t.id;if(!l){let e=Math.random().toString(36).slice(2,7);l="box_".concat(Date.now(),"_").concat(e)}let n=Math.max(16,Math.round(t.w)),a=Math.max(16,Math.round(t.h));return e(e=>{var o,i;let r=e.layers.length;e.overlay.push({id:l,x:Math.round(t.x),y:Math.round(t.y),w:n,h:a,contentType:null!==(o=t.contentType)&&void 0!==o?o:"none"}),e.layers.push({id:l,name:null!==(i=t.name)&&void 0!==i?i:l,z:r}),e.ui.currentTool="none",e.selectedId=l}),l}})));var u=l(5236),v=l(9842),g=l(9854),h=l(5566);let p={apiKey:h.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:h.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:h.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:h.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:h.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:h.env.NEXT_PUBLIC_FIREBASE_APP_ID},m=(0,u.C6)().length?(0,u.C6)()[0]:(0,u.ZF)(p),x=(0,v.ad)(m),f=(0,g.cF)(m);function b(e){let{projectId:t="demo",canvasId:l="root",scope:o={type:"root"},presentation:i=!1,isAuthorized:d=!1}=e,s=c(e=>e.overlay),u=c(e=>e.setOverlay),g=c(e=>e.updateOverlay),h=c(e=>e.layers),p=c(e=>e.setLayers),m=c(e=>e.createBox),f=c(e=>e.ui.currentTool),b=c(e=>e.setTool),N=c(e=>e.openBoxModal),S=(0,a.useRef)(null),[I,k]=(0,a.useState)(null),[E,C]=(0,a.useState)(null),B=c(e=>e.selectedId),T=c(e=>e.setSelectedId),_=(0,a.useMemo)(()=>{let e={};return h.forEach(t=>{e[t.id]=t.z}),e},[h]),A=()=>{let e=["interoperable-canvas",t];return(null==o?void 0:o.type)==="child"&&e.push("child-canvases",o.childId),e.push("canvases",l),e};return(0,a.useEffect)(()=>{if(!t)return;let e=(0,v.hJ)(x,A().concat(["overlay"]).join("/")),l=(0,v.cf)(e,e=>{let t=[];e.forEach(e=>t.push(e.data())),u(t);let l={};t.forEach(e=>{(null==e?void 0:e.id)&&(l[e.id]=e.name||e.id)});let n={};h.forEach(e=>{n[e.id]=e});let a=[];a.push({id:"background",name:"Background",z:0}),h.filter(e=>"background"!==e.id).forEach(e=>{var t,n;let o=null!==(n=null!==(t=l[e.id])&&void 0!==t?t:e.name)&&void 0!==n?n:e.id;a.push({...e,name:o})}),t.forEach(e=>{if(!n[e.id]){var t;a.push({id:e.id,name:null!==(t=l[e.id])&&void 0!==t?t:e.id,z:a.length})}});let o=a.map((e,t)=>({...e,z:t}));(o.length!==h.length||o.some((e,t)=>{var l,n;return(null===(l=h[t])||void 0===l?void 0:l.id)!==e.id||(null===(n=h[t])||void 0===n?void 0:n.name)!==e.name}))&&p(o)});return()=>l()},[t,l,(null==o?void 0:o.type)==="child"?o.childId:"root",u]),(0,n.jsxs)("div",{ref:S,className:"w-full h-full absolute inset-0",style:{zIndex:1},onPointerDown:e=>{var t;if(i||!d||"add-box"!==f)return;let l=null===(t=S.current)||void 0===t?void 0:t.getBoundingClientRect();if(!l)return;let n=e.clientX-l.left,a=e.clientY-l.top;k({x:n,y:a}),C({x:n,y:a,w:0,h:0})},onPointerMove:e=>{var t;if(i||!d||"add-box"!==f||!I)return;let l=null===(t=S.current)||void 0===t?void 0:t.getBoundingClientRect();if(!l)return;let n=e.clientX-l.left,a=e.clientY-l.top,o=Math.min(I.x,n);C({x:o,y:Math.min(I.y,a),w:Math.abs(n-I.x),h:Math.abs(a-I.y)})},onPointerUp:()=>{if(i||!d||"add-box"!==f||!I||!E)return;let e=Math.max(40,E.w),t=Math.max(40,E.h),l=m({x:E.x,y:E.y,w:e,h:t}),n=(0,v.JU)(x,A().concat(["overlay",l]).join("/")),a=(Array.isArray(s)?s.length:0)+1,o="Box ".concat(a),r="".concat(o,"_").concat((()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),l=e.getFullYear(),n=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(l).concat(n).concat(a).concat(o).concat(i).concat(r)})());(0,v.pl)(n,{id:l,x:Math.round(E.x),y:Math.round(E.y),w:e,h:t,contentType:"none",name:o,nameKey:r},{merge:!0}),T(l),k(null),C(null),b("none")},children:[(d||i)&&s.map(e=>{var t,l,a,o,s,c,u,h,p,m,f,b,S,I;return(0,n.jsx)(r.s,{size:{width:e.w,height:e.h},position:{x:e.x,y:e.y},disableDragging:i||!d,disableResizing:i||!d,onDragStop:i||!d?void 0:(t,l)=>{let n=Math.round(l.x),a=Math.round(l.y);g(e.id,{x:n,y:a});let o=(0,v.JU)(x,A().concat(["overlay",e.id]).join("/"));(0,v.pl)(o,{x:n,y:a},{merge:!0})},onResizeStop:i||!d?void 0:(t,l,n,a,o)=>{let i=Math.round(n.offsetWidth),r=Math.round(n.offsetHeight),d=Math.round(o.x),s=Math.round(o.y);g(e.id,{w:i,h:r,x:d,y:s});let c=(0,v.JU)(x,A().concat(["overlay",e.id]).join("/"));(0,v.pl)(c,{w:i,h:r,x:d,y:s},{merge:!0})},bounds:"parent",style:{border:i?"none":e.id===B?"2px solid #ffcf33":"none",background:(()=>{var t,l,n,a,o;let i=e.background;return i&&"none"!==i.mode?"solid"===i.mode?null!==(t=i.from)&&void 0!==t?t:"#000000":"linear"===i.mode?"linear-gradient(135deg, ".concat(null!==(l=i.from)&&void 0!==l?l:"#000000",", ").concat(null!==(n=i.to)&&void 0!==n?n:"#000000",")"):"radial"===i.mode?"radial-gradient(circle, ".concat(null!==(a=i.from)&&void 0!==a?a:"#000000",", ").concat(null!==(o=i.to)&&void 0!==o?o:"#000000",")"):"transparent":"transparent"})(),borderRadius:8,overflow:"hidden",zIndex:null!==(u=_[e.id])&&void 0!==u?u:1},onClick:i||!d?void 0:()=>T(e.id),onDoubleClick:i||!d?void 0:()=>N(e.id),children:(0,n.jsxs)("div",{className:"w-full h-full",children:["text"===e.contentType&&(0,n.jsx)(y,{text:null!==(h=null===(t=e.text)||void 0===t?void 0:t.content)&&void 0!==h?h:"",color:null!==(p=null===(l=e.text)||void 0===l?void 0:l.color)&&void 0!==p?p:"#ffffff",bold:!!(null===(a=e.text)||void 0===a?void 0:a.bold),align:null!==(m=null===(o=e.text)||void 0===o?void 0:o.align)&&void 0!==m?m:"left",fitToWidth:!!(null===(s=e.text)||void 0===s?void 0:s.fitToWidth),baseFontSize:null!==(f=null===(c=e.text)||void 0===c?void 0:c.fontSize)&&void 0!==f?f:18}),"image"===e.contentType&&e.imageSrc&&(0,n.jsx)("img",{src:e.imageSrc,alt:"",style:{width:"100%",height:"100%",objectFit:null!==(b=e.imageBehavior)&&void 0!==b?b:"contain",objectPosition:"center"}}),"animation"===e.contentType&&e.lottieSrc&&(0,n.jsx)(j,{lottieSrc:e.lottieSrc,loop:null===(S=e.loop)||void 0===S||S,autoplay:null===(I=e.autoplay)||void 0===I||I}),"dune"===e.contentType&&(0,n.jsx)(w,{dune:e.dune})]})},e.id)}),"add-box"===f&&E&&(0,n.jsx)("div",{className:"absolute border-2 border-blue-400/70 bg-blue-400/10",style:{left:E.x,top:E.y,width:E.w,height:E.h,pointerEvents:"none"}})]})}function y(e){let{text:t,color:l,bold:o,align:i,fitToWidth:r,baseFontSize:d}=e,s=(0,a.useRef)(null),[c,u]=(0,a.useState)(d),[v,g]=(0,a.useState)(1.2);return(0,a.useEffect)(()=>{if(!r){u(d),g(1.2);return}let e=s.current;if(!e)return;let l=e.parentElement;if(!l)return;let n=()=>{let e=l.clientWidth-16,n=l.clientHeight-16;if(e<=0||n<=0)return;let a=t.length,o=Math.ceil(.6*a*d/e);u(Math.max(8,Math.min(200,Math.floor(Math.min(e/(.6*a),n/1.2,n/(1.2*o)))))),g(1.2)};n();let a=new ResizeObserver(n);return a.observe(l),()=>{a.disconnect()}},[r,d,t]),(0,n.jsx)("div",{ref:s,style:{color:l,fontSize:c,fontWeight:o?700:400,lineHeight:v,display:"flex",alignItems:"center",justifyContent:"left"===i?"flex-start":"center"===i?"center":"flex-end",width:"100%",height:"100%",padding:8,textAlign:i,wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:t})}function j(e){let{lottieSrc:t,loop:l,autoplay:o}=e,[r,d]=(0,a.useState)(null),[s,c]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let e=async()=>{try{c(!0);let e=t.split("/o/");if(2!==e.length)throw Error("Invalid Lottie URL format");let l=e[1].split("?")[0],n=decodeURIComponent(l),a=(0,g.iH)(f,n),o=await (0,g.Pw)(a),i=new TextDecoder().decode(o),r=JSON.parse(i);d(r)}catch(e){console.error("Failed to load Lottie animation:",e)}finally{c(!1)}};t&&e()},[t]),s||!r)?(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"Loading..."})}):(0,n.jsx)(i(),{animationData:r,loop:"boolean"==typeof l?l:l>0,autoplay:o,style:{width:"100%",height:"100%"},renderer:"canvas",rendererSettings:{progressiveLoad:!0,clearCanvas:!0,preserveAspectRatio:"none",dpr:window.devicePixelRatio}})}function w(e){var t,o;let{dune:i}=e,[r,d]=(0,a.useState)(null),[s,c]=(0,a.useState)(!0),[u,v]=(0,a.useState)(null),g=(0,a.useRef)(null),h=(0,a.useRef)(null);return((0,a.useEffect)(()=>{if(!(null==i?void 0:i.queryId)){c(!1),v("No query ID configured");return}(async()=>{c(!0),v(null);try{let e=await fetch("/api/dune/latest?queryId=".concat(encodeURIComponent(i.queryId))),t=await e.json();if(!t.ok)throw Error(t.error||"API error");d(t.data)}catch(e){v(e.message||"Failed to load")}finally{c(!1)}})()},[null==i?void 0:i.queryId]),(0,a.useEffect)(()=>{var e,t,n,a,o,d;let s=null!==(n=null==r?void 0:null===(e=r.result)||void 0===e?void 0:e.rows)&&void 0!==n?n:[];if(!g.current||0===s.length)return;h.current&&(h.current.destroy(),h.current=null);let c=Object.keys(null!==(a=s[0])&&void 0!==a?a:[]),u=null!==(o=null==i?void 0:i.datesColumn)&&void 0!==o?o:"",v=u&&c.includes(u)?u:c.find(e=>{var t;return"string"==typeof(null===(t=s[0])||void 0===t?void 0:t[e])})||c[0],p=null!==(d=null==i?void 0:null===(t=i.valueColumns)||void 0===t?void 0:t.filter(e=>""!==e.trim()&&c.includes(e)))&&void 0!==d?d:[],m=p.length>0?p:c.filter(e=>{var t;return e!==v&&"number"==typeof(null===(t=s[0])||void 0===t?void 0:t[e])});if(0===m.length)return;let x=e=>{if(null==e)return null;if("number"==typeof e){let t=new Date(e);return Number.isNaN(t.getTime())?null:t}if("string"==typeof e){let a=e.trim(),o=new Date(a);if(!Number.isNaN(o.getTime()))return o;let i=a.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/);if(i){var t,l,n;let e=Number(i[1]),a=Number(i[2])-1,o=Number(i[3]),r=new Date(Date.UTC(e,a,o,Number(null!==(t=i[4])&&void 0!==t?t:"0"),Number(null!==(l=i[5])&&void 0!==l?l:"0"),Number(null!==(n=i[6])&&void 0!==n?n:"0")));return Number.isNaN(r.getTime())?null:r}}return null},f=s.slice(),b=s.map(e=>{var t,l;return{r:e,d:x(e[v]),ts:null!==(l=null===(t=x(e[v]))||void 0===t?void 0:t.getTime())&&void 0!==l?l:0}}).filter(e=>!!e.d&&e.ts>0);b.length>0&&(f=b.sort((e,t)=>e.ts-t.ts).map(e=>e.r));let y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],j=e=>{if("string"==typeof e&&e.includes("-")&&e.length>10){let t=new Date(e);if(!Number.isNaN(t.getTime()))return"".concat(y[t.getUTCMonth()],"-").concat(t.getUTCFullYear())}let t=x(e);return t?"".concat(y[t.getUTCMonth()],"-").concat(t.getUTCFullYear()):String(null!=e?e:"")},w=f.map(e=>j(e[v]));return Promise.all([l.e(674),l.e(621)]).then(l.bind(l,433)).then(e=>{var t,l;let n=e.default,a=null===(t=g.current)||void 0===t?void 0:t.getContext("2d");if(!a)return;let o=Math.max(2,null!==(l=null==i?void 0:i.datesToShow)&&void 0!==l?l:4),r=w.length,d=[];for(let e=0;e<o;e++){let t=Math.round((1===o?.5:e/(o-1))*(r-1));d.push(t)}let s=[{border:"hsl(28, 90%, 50%)",fill:"hsla(28, 90%, 50%, 0.20)"},{border:"hsl(210, 70%, 50%)",fill:"hsla(210, 70%, 50%, 0.20)"},{border:"hsl(120, 70%, 50%)",fill:"hsla(120, 70%, 50%, 0.20)"},{border:"hsl(0, 70%, 50%)",fill:"hsla(0, 70%, 50%, 0.20)"}],c=m.map((e,t)=>({label:e,data:f.map(t=>t[e]),borderColor:s[t%s.length].border,backgroundColor:s[t%s.length].fill,fill:!0,tension:.35,pointRadius:0,borderWidth:2}));h.current=new n(a,{type:"line",data:{labels:w,datasets:c},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{x:{type:"category",display:!0,grid:{display:!1},afterBuildTicks:e=>{e.ticks=d.map(e=>({value:e,label:w[e]}))},ticks:{callback:function(e){return this.getLabelForValue(e)}}},y:{display:!1,grid:{display:!1},beginAtZero:!0}},elements:{line:{borderJoinStyle:"round"}}}})}).catch(()=>{}),()=>{h.current&&(h.current.destroy(),h.current=null)}},[r,i]),null==i?void 0:i.queryId)?s?(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-gray-200 text-xs",children:(0,n.jsx)("div",{children:"Loading Dune data..."})}):u?(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-red-300 text-xs px-2",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"font-semibold",children:"Error"}),(0,n.jsx)("div",{children:u})]})}):0===(null!==(o=null==r?void 0:null===(t=r.result)||void 0===t?void 0:t.rows)&&void 0!==o?o:[]).length?(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-gray-200 text-xs",children:(0,n.jsx)("div",{children:"No data returned from query"})}):(0,n.jsx)("div",{className:"w-full h-full relative",style:{background:"white"},children:(0,n.jsx)("canvas",{ref:g,className:"absolute inset-0 w-full h-full"})}):(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-900/40 text-gray-200 text-xs px-2",children:"Add a Dune URL or query_id in the box settings."})}function N(e){let{projectId:t="demo",scope:l={type:"root"},canvasId:a="root",presentation:o=!1,isAuthorized:i=!1}=e;return(0,n.jsx)("div",{className:"w-full h-full relative",children:(0,n.jsx)(b,{projectId:t,canvasId:a,scope:l,presentation:o,isAuthorized:i})})}function S(){let e=c(e=>e.openBackgroundModal),t=c(e=>e.setTool);return(0,n.jsxs)("div",{className:"space-y-2 relative",children:[(0,n.jsx)("button",{className:"w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>t("add-box"),children:"Add Box"}),(0,n.jsx)("button",{className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>e(),children:"Background"}),(0,n.jsx)("button",{className:"w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:c.getState().openLayersModal,children:"Layers"})]})}function I(e){let{onAspectChange:t}=e,{aspect:l,setAspect:a}=c(),o=e=>{a(e),null==t||t(e)};return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Aspect Ratio"}),(0,n.jsxs)("select",{value:l,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",children:[(0,n.jsx)("option",{value:"16:9",children:"16:9 (Widescreen)"}),(0,n.jsx)("option",{value:"4:3",children:"4:3 (Standard)"}),(0,n.jsx)("option",{value:"1:1",children:"1:1 (Square)"}),(0,n.jsx)("option",{value:"4:6",children:"4:6 (Vertical Post)"}),(0,n.jsx)("option",{value:"9:16",children:"9:16 (Vertical Stories)"}),(0,n.jsx)("option",{value:"mini-app",children:"Mini App (9:16 safe)"}),(0,n.jsx)("option",{value:"landing-page",children:"Desktop Landing (Infinite Height)"}),(0,n.jsx)("option",{value:"mobile-landing-page",children:"Mobile Landing (Infinite Height)"})]})]})}function k(e){let{from:t,to:l,className:o="",style:i={}}=e,r=(0,a.useRef)(null),[d,s]=(0,a.useState)(1),[c,u]=(0,a.useState)(()=>window.innerHeight);return(0,a.useEffect)(()=>{let e=()=>{u(window.innerHeight)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{if(!r.current)return;let e=()=>{let e=r.current;if(!e)return;let t=e.parentElement;s(Math.max(1,Math.ceil((t?Math.max(t.scrollHeight,t.clientHeight,e.scrollHeight,e.clientHeight):Math.max(e.scrollHeight,e.clientHeight,c))/(2*c))+1))},t=setTimeout(e,0),l=new ResizeObserver(e);return l.observe(r.current),r.current.parentElement&&l.observe(r.current.parentElement),()=>{clearTimeout(t),l.disconnect()}},[c]),(0,n.jsx)("div",{ref:r,className:"absolute inset-0 w-full ".concat(o),style:{...i,zIndex:0,pointerEvents:"none"},children:Array.from({length:d}).map((e,a)=>{let o=a%2==0,i=a*c*2,r=2*c,d="".concat(t," 0%, ").concat(l," 50%, ").concat(t," 100%");return(0,n.jsx)("div",{className:"absolute left-0 right-0",style:{top:"".concat(i,"px"),height:"".concat(r,"px"),width:"100%",background:o?"linear-gradient(135deg, ".concat(d,")"):"linear-gradient(225deg, ".concat(d,")"),zIndex:0,pointerEvents:"none"}},a)})})}function E(e){let{aspect:t,backgroundColor:l,backgroundMode:o,backgroundFrom:i,backgroundTo:r,className:d="",children:s,presentation:u=!1,fullscreen:v=!1}=e,g=c(e=>e.overlay),[h,p]=(0,a.useState)(()=>window.innerHeight);(0,a.useEffect)(()=>{let e=()=>{p(window.innerHeight)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let m=()=>{switch(t){case"1:1":default:return"aspect-square";case"16:9":return"aspect-video";case"4:3":return"aspect-[4/3]";case"9:16":case"mini-app":return"aspect-[9/16]";case"4:6":return"aspect-[4/6]";case"landing-page":case"mobile-landing-page":return""}},x=(0,a.useMemo)(()=>{if("landing-page"!==t&&"mobile-landing-page"!==t)return null;if(0===g.length)return h;let e=g.reduce((e,t)=>{let l=t.y+t.h;return l>e?l:e},0),l=.5*h;return Math.max(h,e+l)},[t,g,h]),f=()=>"landing-page"===t||"mobile-landing-page"===t?"w-full flex justify-center":"w-full h-screen flex items-center justify-center",b=()=>v?"".concat(m()," w-full h-full"):"landing-page"===t?u?"block mt-[20px] box-border":"block mt-[20px] box-border w-full max-w-full":"mobile-landing-page"===t?"block mt-[20px] box-border":"1:1"===t?"".concat(m()," h-[95%] max-w-full mx-[10px]"):"16:9"===t?"".concat(m()," w-full max-h-full mx-[20px]"):"4:3"===t?"".concat(m()," h-[95%] max-w-full mx-[20px]"):"".concat(m()," h-[95%] max-w-full mx-[10px]");return"mini-app"===t?(0,n.jsx)("div",{className:"".concat(f()," ").concat(d),children:(0,n.jsx)("div",{className:b(),children:(0,n.jsxs)("div",{className:"w-full h-full relative overflow-hidden",style:{background:l||"transparent",position:"relative"},children:["zigzag"===o&&i&&r&&(0,n.jsx)(k,{from:i,to:r}),!u&&(0,n.jsx)("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:0,height:"10%",background:"#ffffff",borderBottom:"1px solid rgba(0,0,0,0.08)",pointerEvents:"none",zIndex:2}}),(0,n.jsx)("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:u?"0%":"10%",bottom:"2.5%"},children:(0,n.jsx)("div",{className:"w-full h-full relative",style:{zIndex:1},children:s})})]})})}):"landing-page"===t?(0,n.jsx)("div",{className:"".concat(f()," ").concat(d),children:(0,n.jsx)("div",{className:b(),style:{minHeight:x||"100vh",height:x?"".concat(x,"px"):"auto",width:u?"1100px":"100%",maxWidth:u?"1100px":"100%",boxSizing:"border-box",border:"none"},children:(0,n.jsxs)("div",{className:"w-full relative mx-auto",style:{background:l||"transparent",minHeight:x||"100vh",height:x?"".concat(x,"px"):"auto",width:u?"1100px":"100%",maxWidth:u?"1100px":"100%",boxSizing:"border-box",border:"none",zIndex:u?1:"auto",position:"relative"},children:["zigzag"===o&&i&&r&&(0,n.jsx)(k,{from:i,to:r}),s]})})}):"mobile-landing-page"===t?(0,n.jsx)("div",{className:"".concat(f()," ").concat(d),children:(0,n.jsx)("div",{className:b(),style:{minHeight:x||"100vh",height:x?"".concat(x,"px"):"auto",width:"390px",maxWidth:"390px",boxSizing:"border-box",border:"none"},children:(0,n.jsxs)("div",{className:"w-full relative mx-auto",style:{background:l||"transparent",minHeight:x||"100vh",height:x?"".concat(x,"px"):"auto",width:"390px",maxWidth:"390px",boxSizing:"border-box",border:"none",zIndex:u?1:"auto",position:"relative"},children:["zigzag"===o&&i&&r&&(0,n.jsx)(k,{from:i,to:r}),s]})})}):(0,n.jsx)("div",{className:"".concat(f()," ").concat(d),children:(0,n.jsx)("div",{className:b(),children:(0,n.jsxs)("div",{className:"w-full h-full relative overflow-hidden",style:{background:l||"transparent",position:"relative"},children:["zigzag"===o&&i&&r&&(0,n.jsx)(k,{from:i,to:r}),s]})})})}function C(e){let{open:t,mode:l,from:o,to:i,onClose:r,onSave:d}=e,[s,c]=(0,a.useState)(null!=l?l:"linear"),[u,v]=(0,a.useState)(o),[g,h]=(0,a.useState)(i);a.useEffect(()=>{t&&(c(null!=l?l:"linear"),v(o),h(i))},[t,l,o,i]);let p=(0,a.useMemo)(()=>"solid"===s?u:"linear"===s?"linear-gradient(135deg, ".concat(u,", ").concat(g,")"):"radial"===s?"radial-gradient(circle, ".concat(u,", ").concat(g,")"):"zigzag"===s?"linear-gradient(135deg, ".concat(u,", ").concat(g,")"):"transparent",[s,u,g]);return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Background"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"h-24 rounded",style:{background:p}}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Type"}),(0,n.jsxs)("select",{className:"w-full px-3 py-2 border rounded",value:s,onChange:e=>c(e.target.value),children:[(0,n.jsx)("option",{value:"none",children:"No background"}),(0,n.jsx)("option",{value:"solid",children:"Solid"}),(0,n.jsx)("option",{value:"linear",children:"Linear gradient"}),(0,n.jsx)("option",{value:"radial",children:"Radial gradient"}),(0,n.jsx)("option",{value:"zigzag",children:"Zigzag gradient"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"From Color"}),(0,n.jsx)("input",{type:"color",value:u,onChange:e=>v(e.target.value),className:"w-full h-10 border rounded"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"To Color"}),(0,n.jsx)("input",{type:"color",value:g,onChange:e=>h(e.target.value),className:"w-full h-10 border rounded"})]})]}),(0,n.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,n.jsx)("button",{onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>{"none"===s?d({mode:"none",from:"transparent",to:"transparent"}):"solid"===s?d({mode:"solid",from:u,to:u}):"linear"===s?d({mode:"linear",from:u,to:g}):"radial"===s?d({mode:"radial",from:u,to:g}):"zigzag"===s&&d({mode:"zigzag",from:u,to:g})},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"})]})]})}):null}var B=l(5566);let T={apiKey:B.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:B.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:B.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:B.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:B.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:B.env.NEXT_PUBLIC_FIREBASE_APP_ID},_=(0,u.C6)().length?(0,u.C6)()[0]:(0,u.ZF)(T),A=(0,v.ad)(_);function M(e){let{open:t,onClose:l,projectId:o,canvasId:i="root",scope:r={type:"root"}}=e,d=c(e=>e.layers),s=c(e=>e.overlay),u=c(e=>e.moveLayerUp),g=c(e=>e.moveLayerDown),h=c(e=>e.selectedId),p=c(e=>e.setSelectedId),[m,x]=(0,a.useState)(null),[f,b]=(0,a.useState)(""),y=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),l=e.getFullYear(),n=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(l).concat(n).concat(a).concat(o).concat(i).concat(r)},j=()=>{let e=["interoperable-canvas",o];return(null==r?void 0:r.type)==="child"&&e.push("child-canvases",r.childId),e.push("canvases",i),e},w=async(e,t)=>{if(!t.trim()||!o){x(null);return}let l="".concat(t.trim(),"_").concat(y()),n=(0,v.JU)(A,j().concat(["overlay",e]).join("/"));await (0,v.pl)(n,{name:t.trim(),nameKey:l},{merge:!0}),x(null)};return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Layers"}),(0,n.jsx)("button",{onClick:l,className:"px-3 py-1 border rounded hover:bg-gray-50",children:"Close"})]}),(0,n.jsxs)("div",{className:"space-y-2 max-h-80 overflow-auto",children:[0===d.length&&(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"No layers yet. Add items to populate."}),[...d].sort((e,t)=>t.z-e.z).map(e=>{var t;return(0,n.jsxs)("div",{className:"flex items-center justify-between border rounded px-3 py-2 ".concat(h===e.id?"bg-gray-100":""),onClick:()=>"background"!==e.id&&p(e.id),children:[(0,n.jsx)("div",{className:"truncate",children:m===e.id?(0,n.jsx)("input",{className:"text-sm border rounded px-1 py-0.5 w-40",autoFocus:!0,value:f,onChange:e=>b(e.target.value),onKeyDown:t=>{var l;let n=(null===(l=s.find(t=>t.id===e.id))||void 0===l?void 0:l.name)||e.name||e.id;"Enter"===t.key&&(t.preventDefault(),w(e.id,f||n)),"Escape"===t.key&&x(null)},onBlur:()=>{var t;let l=(null===(t=s.find(t=>t.id===e.id))||void 0===t?void 0:t.name)||e.name||e.id;w(e.id,f||l)}}):(0,n.jsx)("button",{className:"font-medium text-left truncate",onClick:t=>{var l;t.stopPropagation();let n=(null===(l=s.find(t=>t.id===e.id))||void 0===l?void 0:l.name)||e.name||e.id;x(e.id),b(n)},children:(null===(t=s.find(t=>t.id===e.id))||void 0===t?void 0:t.name)||e.name||e.id})}),(0,n.jsxs)("div",{className:"flex gap-1",children:["background"!==e.id&&(0,n.jsx)("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Up",onClick:t=>{t.stopPropagation(),u(e.id)},children:"▲"}),"background"!==e.id&&e.z>1&&(0,n.jsx)("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Down",onClick:t=>{t.stopPropagation(),g(e.id)},children:"▼"})]})]},e.id)})]})]})}):null}var L=l(5566);let z={apiKey:L.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:L.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:L.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:L.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:L.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:L.env.NEXT_PUBLIC_FIREBASE_APP_ID},U=(0,u.C6)().length?(0,u.C6)()[0]:(0,u.ZF)(z),R=(0,v.ad)(U),P=(0,g.cF)(U);function D(e){var t,l,o,r,d,s,u,h,p,m,x,f,b,y,j,w,N,S,I,k,E,C,B,T,_,A,M,L,z,U,D,O,J,K,H,X,W,q,G,Y,Q,Z,V,$,ee,et,el,en,ea,eo,ei,er,ed,es;let{projectId:ec="demo",canvasId:eu="root",scope:ev={type:"root"}}=e,eg=c(e=>e.ui.showBoxModal),eh=c(e=>e.closeBoxModal),ep=c(e=>e.selectedId),em=c(e=>e.overlay),ex=(0,a.useMemo)(()=>em.find(e=>e.id===ep),[em,ep]),[ef,eb]=(0,a.useState)("background"),[ey,ej]=(0,a.useState)({}),[ew,eN]=(0,a.useState)([""]),eS=(0,a.useRef)(null),eI=(0,a.useRef)(null),[ek,eE]=(0,a.useState)(!1),[eC,eB]=(0,a.useState)(null),[eT,e_]=(0,a.useState)(null),[eA,eM]=(0,a.useState)(null),[eL,ez]=(0,a.useState)(!1),[eU,eR]=(0,a.useState)(!1),[eP,eD]=(0,a.useState)([]),[eF,eO]=(0,a.useState)(!1),eJ=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),l=e.getFullYear(),n=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(l).concat(n).concat(a).concat(o).concat(i).concat(r)},eK=async()=>{try{let e=(0,v.hJ)(R,"interoperable-canvas",ec,"images"),t=(0,v.IO)(e,(0,v.b9)(1)),l=await (0,v.PL)(t);ez(!l.empty)}catch(e){ez(!1)}},eH=async()=>{try{let t=(0,v.hJ)(R,"interoperable-canvas",ec,"images"),l=await (0,v.PL)(t),n=[];for(let t of l.docs){var e;let l=t.data(),a=null==l?void 0:l.storagePath,o=null!==(e=null==l?void 0:l.filename)&&void 0!==e?e:t.id;if(a)try{let e=(0,g.iH)(P,a),l=await (0,g.Jt)(e);n.push({id:t.id,name:o,url:l})}catch(e){}}eD(n)}catch(e){eD([])}};if((0,a.useEffect)(()=>{eg&&"image"===ef&&eK()},[eg,ef,ec]),(0,a.useEffect)(()=>{var e,t;if(!eg)return;let l=null!==(t=null==ex?void 0:ex.contentType)&&void 0!==t?t:"none";"text"===l||"image"===l||"animation"===l||"dune"===l?eb(l):eb("background"),"dune"===l&&(null==ex?void 0:null===(e=ex.dune)||void 0===e?void 0:e.valueColumns)?eN(ex.dune.valueColumns):0===ew.length&&eN([""])},[eg,ep,null==ex?void 0:ex.contentType]),(0,a.useEffect)(()=>{eg&&(null==ex?void 0:ex.lottieSrc)&&"animation"===ex.contentType&&(async()=>{try{let e=ex.lottieSrc.split("/o/");if(2!==e.length){console.error("Invalid Lottie URL format");return}let t=e[1].split("?")[0],l=decodeURIComponent(t),n=(0,g.iH)(P,l),a=await (0,g.Pw)(n),o=new TextDecoder().decode(a),i=JSON.parse(o);eM(i)}catch(e){console.error("Failed to load existing Lottie animation:",e)}})()},[eg,null==ex?void 0:ex.lottieSrc,null==ex?void 0:ex.contentType]),!eg||!ep)return null;let eX=async e=>{if(eB(null),e){if(!("image/jpeg"===e.type||"image/png"===e.type)){eB("Only JPG or PNG files are accepted.");return}if(e.size>1048576){eB("Maximum size is 1MB.");return}eE(!0);try{var t,l;let n=e.name,a=n.lastIndexOf("."),o=a>-1?n.slice(0,a):n,i=a>-1?n.slice(a+1):"jpg",r="".concat(o,"_").concat(eJ(),".").concat(i),d=(null==ev?void 0:ev.type)==="child"?"interoperable-canvas/assets/".concat(ec,"/child-canvases/").concat(ev.childId,"/images/").concat(r):"interoperable-canvas/assets/".concat(ec,"/images/").concat(r),s=(0,g.iH)(P,d);await (0,g.KV)(s,e,{contentType:e.type,cacheControl:"public, max-age=31536000, immutable"});let c=await (0,g.Jt)(s),u=URL.createObjectURL(e);e_(u);let h=await new Promise(e=>{let t=new Image;t.onload=()=>{e({width:t.naturalWidth,height:t.naturalHeight}),URL.revokeObjectURL(u)},t.src=u}),p=(0,v.JU)(R,"interoperable-canvas",ec,"images",r);await (0,v.pl)(p,{filename:r,originalName:n,storagePath:d,mimeType:e.type,sizeBytes:e.size,width:h.width,height:h.height,uploadedAt:(0,v.Bt)()},{merge:!0}),ej({...ey,imageSrc:c,imageBehavior:null!==(l=null!==(t=ey.imageBehavior)&&void 0!==t?t:null==ex?void 0:ex.imageBehavior)&&void 0!==l?l:"contain"}),ez(!0)}catch(e){eB("Upload failed. Please try again.")}finally{eE(!1)}}},eW=async()=>{let e=!eU;eR(e),e&&0===eP.length&&await eH()},eq=async e=>{if(eB(null),e){if(!("application/json"===e.type||e.name.endsWith(".json"))){eB("Only JSON files are accepted.");return}if(e.size>2097152){eB("Maximum size is 2MB.");return}eE(!0);try{let t=e.name,l=t.lastIndexOf("."),n=l>-1?t.slice(0,l):t,a="".concat(n,"_").concat(eJ(),".json"),o=(null==ev?void 0:ev.type)==="child"?"interoperable-canvas/assets/".concat(ec,"/child-canvases/").concat(ev.childId,"/animations/").concat(a):"interoperable-canvas/assets/".concat(ec,"/animations/").concat(a),i=(0,g.iH)(P,o);await (0,g.KV)(i,e,{contentType:"application/json",cacheControl:"public, max-age=31536000, immutable"});let r=await (0,g.Jt)(i),d=new FileReader;d.onload=e=>{try{var t;let l=JSON.parse(null===(t=e.target)||void 0===t?void 0:t.result);eM(l),ej({...ey,lottieSrc:r})}catch(e){console.error("Failed to parse Lottie JSON:",e),eB("Invalid Lottie JSON file.")}},d.readAsText(e);let s=(0,v.JU)(R,"interoperable-canvas",ec,"animations",a);await (0,v.pl)(s,{filename:a,originalName:t,storagePath:o,mimeType:"application/json",sizeBytes:e.size,uploadedAt:(0,v.Bt)()},{merge:!0})}catch(e){eB("Upload failed. Please try again.")}finally{eE(!1)}}},eG=()=>{let e=["interoperable-canvas",ec];return(null==ev?void 0:ev.type)==="child"&&e.push("child-canvases",ev.childId),e.push("canvases",eu),e},eY=async()=>{var e,t,l,n,a,o,i,r,d,s,c,u,g,h,p,m,x,f,b,y,j,w,N,S,I,k,E,C,B,T,_,A,M,L,z,U;if(!ep)return;let P=(0,v.JU)(R,eG().concat(["overlay",ep]).join("/")),D={};"background"===ef&&(D.background=null!==(e=ey.background)&&void 0!==e?e:{mode:"none"});let F="text"===ef?"text":"image"===ef?"image":"animation"===ef?"animation":"dune"===ef?"dune":null;if(F&&(null==ex?void 0:ex.contentType)&&ex.contentType!==F){let e={text:"text",image:"image",animation:"animation",dune:"dune"},l=null!==(t=e[ex.contentType])&&void 0!==t?t:null;if(l&&!window.confirm("You can only add one asset per box. Adding ".concat(e[F]," will remove ").concat(l,". Continue?")))return}if("text"===ef&&(D.contentType="text",D.text={content:null!==(s=null!==(d=ey.text)&&void 0!==d?d:null==ex?void 0:null===(l=ex.text)||void 0===l?void 0:l.content)&&void 0!==s?s:"",fontSize:void 0!==ey.fontSize?Number(ey.fontSize):null!==(c=null==ex?void 0:null===(n=ex.text)||void 0===n?void 0:n.fontSize)&&void 0!==c?c:18,color:null!==(g=null!==(u=ey.color)&&void 0!==u?u:null==ex?void 0:null===(a=ex.text)||void 0===a?void 0:a.color)&&void 0!==g?g:"#ffffff",bold:void 0!==ey.bold?!!ey.bold:null!==(h=null==ex?void 0:null===(o=ex.text)||void 0===o?void 0:o.bold)&&void 0!==h&&h,align:null!==(m=null!==(p=ey.align)&&void 0!==p?p:null==ex?void 0:null===(i=ex.text)||void 0===i?void 0:i.align)&&void 0!==m?m:"left",fitToWidth:void 0!==ey.fitToWidth?!!ey.fitToWidth:null!==(x=null==ex?void 0:null===(r=ex.text)||void 0===r?void 0:r.fitToWidth)&&void 0!==x&&x},Object.assign(D,{imageSrc:(0,v.AK)(),lottieSrc:(0,v.AK)(),duneQueryId:(0,v.AK)()})),"image"===ef){let e=null!==(f=ey.imageSrc)&&void 0!==f?f:null==ex?void 0:ex.imageSrc;if(!e){window.alert("Please upload or select an image before saving.");return}Object.assign(D,{contentType:"image",imageSrc:e,imageBehavior:null!==(y=null!==(b=ey.imageBehavior)&&void 0!==b?b:null==ex?void 0:ex.imageBehavior)&&void 0!==y?y:"contain"}),Object.assign(D,{text:(0,v.AK)(),lottieSrc:(0,v.AK)(),duneQueryId:(0,v.AK)()})}if("animation"===ef){let e=null!==(j=ey.lottieSrc)&&void 0!==j?j:null==ex?void 0:ex.lottieSrc;if(!e){window.alert("Please upload a Lottie JSON file before saving.");return}Object.assign(D,{contentType:"animation",lottieSrc:e,loop:void 0!==ey.loop?ey.loop:null===(w=null==ex?void 0:ex.loop)||void 0===w||w,autoplay:void 0!==ey.autoplay?ey.autoplay:null===(N=null==ex?void 0:ex.autoplay)||void 0===N||N}),Object.assign(D,{text:(0,v.AK)(),imageSrc:(0,v.AK)(),duneQueryId:(0,v.AK)()})}if("dune"===ef){let{queryId:e,vizId:t,sourceUrl:l}=function(e){let t=(e||"").trim();if(!t)return{};if(/^\d+$/.test(t))return{queryId:t};try{let e=new URL(t).pathname.split("/").filter(Boolean),l=e.findIndex(e=>"queries"===e.toLowerCase());if(l>=0&&e[l+1]){let n=e[l+1],a=e[l+2];return{queryId:n,vizId:a,sourceUrl:t}}let n=e.map(e=>{var t;return null===(t=e.match(/^(\d+)$/))||void 0===t?void 0:t[1]}).filter(Boolean);if(n.length>0)return{queryId:n[0],vizId:n[1],sourceUrl:t};return{sourceUrl:t}}catch(e){return{}}}((null!==(A=null!==(_=null!==(T=null!==(B=null!==(C=ey.duneInput)&&void 0!==C?C:ey.duneQueryId)&&void 0!==B?B:null==ex?void 0:null===(S=ex.dune)||void 0===S?void 0:S.sourceUrl)&&void 0!==T?T:null==ex?void 0:null===(I=ex.dune)||void 0===I?void 0:I.queryId)&&void 0!==_?_:null==ex?void 0:ex.duneQueryId)&&void 0!==A?A:"").toString().trim());if(!e){window.alert("Please provide a valid Dune URL or numeric query_id.");return}let n=l||"https://dune.com/queries/".concat(e).concat(t?"/"+t:""),a=null!==(L=null!==(M=ey.datesToShow)&&void 0!==M?M:null==ex?void 0:null===(k=ex.dune)||void 0===k?void 0:k.datesToShow)&&void 0!==L?L:4,o=null!==(U=null!==(z=ey.datesColumn)&&void 0!==z?z:null==ex?void 0:null===(E=ex.dune)||void 0===E?void 0:E.datesColumn)&&void 0!==U?U:"",i=ew.filter(e=>""!==e.trim());Object.assign(D,{contentType:"dune",dune:{provider:"dune",queryId:e,...t?{vizId:t}:{},sourceUrl:n,version:0,datesToShow:a,datesColumn:o,valueColumns:i},duneQueryId:(0,v.AK)()}),Object.assign(D,{text:(0,v.AK)(),imageSrc:(0,v.AK)(),lottieSrc:(0,v.AK)()})}await (0,v.pl)(P,D,{merge:!0}),eh()},eQ=async()=>{if(ep)try{let e=(0,v.JU)(R,eG().concat(["overlay",ep]).join("/"));await (0,v.oe)(e);let t=(0,v.JU)(R,eG().join("/")),l=await (0,v.QT)(t);if(l.exists()){let e=l.data(),n=(Array.isArray(null==e?void 0:e.layers)?[...e.layers]:[]).filter(e=>e!==ep),a={};n.forEach((e,t)=>{a[e]=t}),await (0,v.pl)(t,{layers:n,zIndexMap:a},{merge:!0})}}finally{eO(!1),eh()}},eZ=e=>{var t;let{id:l,label:a}=e,o=ef===l,i=(null!==(t=null==ex?void 0:ex.contentType)&&void 0!==t?t:"none")===l,r=o&&!i?" bg-gray-200":"",d=o||i?"":" bg-white hover:bg-gray-50";return(0,n.jsx)("button",{className:"".concat("px-2 py-1 text-xs border rounded").concat(i?" bg-green-100 border-green-600 text-green-800":"").concat(r).concat(d),onClick:()=>eb(l),children:a})};return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:(0,n.jsxs)("div",{className:"bg-white text-gray-900 p-4 rounded-lg w-[560px] max-w-[95vw]",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("div",{className:"flex items-center gap-2 min-w-0",children:(0,n.jsx)(F,{projectId:ec,canvasId:eu,selectedId:ep,initialName:(null==ex?void 0:ex.name)||ep})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[!eF&&(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded text-red-700 border-red-600 hover:bg-red-50",onClick:()=>eO(!0),children:"Delete box"}),eF&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-[11px] text-red-700",children:"Delete this box? This cannot be undone."}),(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-red-600 text-white",onClick:eQ,children:"Yes, delete"}),(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>eO(!1),children:"No, go back"})]}),(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded",onClick:eh,children:"Close"}),(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-blue-600 text-white",onClick:eY,children:"Save"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[(0,n.jsx)(eZ,{id:"background",label:"Background"}),(0,n.jsx)(eZ,{id:"text",label:"Text"}),(0,n.jsx)(eZ,{id:"image",label:"Image"}),(0,n.jsx)(eZ,{id:"animation",label:"Animation"}),(0,n.jsx)(eZ,{id:"dune",label:"Dune"})]}),(0,n.jsxs)("div",{className:"border rounded p-3 bg-gray-50",children:["background"===ef&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Mode"}),(0,n.jsxs)("select",{value:null!==(S=null!==(N=null===(t=ey.background)||void 0===t?void 0:t.mode)&&void 0!==N?N:null==ex?void 0:null===(l=ex.background)||void 0===l?void 0:l.mode)&&void 0!==S?S:"none",onChange:e=>{var t;return ej({...ey,background:{...null!==(t=ey.background)&&void 0!==t?t:{},mode:e.target.value}})},children:[(0,n.jsx)("option",{value:"none",children:"None"}),(0,n.jsx)("option",{value:"solid",children:"Solid"}),(0,n.jsx)("option",{value:"linear",children:"Linear"}),(0,n.jsx)("option",{value:"radial",children:"Radial"})]})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"From"}),(0,n.jsx)("input",{type:"color",value:null!==(k=null!==(I=null===(o=ey.background)||void 0===o?void 0:o.from)&&void 0!==I?I:null==ex?void 0:null===(r=ex.background)||void 0===r?void 0:r.from)&&void 0!==k?k:"#000000",onChange:e=>{var t;return ej({...ey,background:{...null!==(t=ey.background)&&void 0!==t?t:{},from:e.target.value}})}})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"To"}),(0,n.jsx)("input",{type:"color",value:null!==(C=null!==(E=null===(d=ey.background)||void 0===d?void 0:d.to)&&void 0!==E?E:null==ex?void 0:null===(s=ex.background)||void 0===s?void 0:s.to)&&void 0!==C?C:"#000000",onChange:e=>{var t;return ej({...ey,background:{...null!==(t=ey.background)&&void 0!==t?t:{},to:e.target.value}})}})]})]}),"text"===ef&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Text"}),(0,n.jsx)("input",{value:null!==(T=null!==(B=ey.text)&&void 0!==B?B:null==ex?void 0:null===(u=ex.text)||void 0===u?void 0:u.content)&&void 0!==T?T:"",onChange:e=>ej({...ey,text:e.target.value})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Font size"}),(0,n.jsx)("input",{type:"number",value:null!==(A=null!==(_=ey.fontSize)&&void 0!==_?_:null==ex?void 0:null===(h=ex.text)||void 0===h?void 0:h.fontSize)&&void 0!==A?A:18,onChange:e=>ej({...ey,fontSize:Number(e.target.value)})})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:null!==(L=null!==(M=ey.fitToWidth)&&void 0!==M?M:null==ex?void 0:null===(p=ex.text)||void 0===p?void 0:p.fitToWidth)&&void 0!==L&&L,onChange:e=>ej({...ey,fitToWidth:e.target.checked})}),(0,n.jsx)("span",{children:"Auto fit width"})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Color"}),(0,n.jsx)("input",{type:"color",value:null!==(U=null!==(z=ey.color)&&void 0!==z?z:null==ex?void 0:null===(m=ex.text)||void 0===m?void 0:m.color)&&void 0!==U?U:"#ffffff",onChange:e=>ej({...ey,color:e.target.value})})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:null!==(O=null!==(D=ey.bold)&&void 0!==D?D:null==ex?void 0:null===(x=ex.text)||void 0===x?void 0:x.bold)&&void 0!==O&&O,onChange:e=>ej({...ey,bold:e.target.checked})}),(0,n.jsx)("span",{children:"Bold"})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Align"}),(0,n.jsxs)("select",{value:null!==(K=null!==(J=ey.align)&&void 0!==J?J:null==ex?void 0:null===(f=ex.text)||void 0===f?void 0:f.align)&&void 0!==K?K:"left",onChange:e=>ej({...ey,align:e.target.value}),children:[(0,n.jsx)("option",{value:"left",children:"Left"}),(0,n.jsx)("option",{value:"center",children:"Center"}),(0,n.jsx)("option",{value:"right",children:"Right"})]})]})]}),"image"===ef&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsx)("div",{className:"text-[11px] text-gray-600",children:"Accepted formats: JPG/PNG. Max size: 1MB."}),eC&&(0,n.jsx)("div",{className:"text-[11px] text-red-600",children:eC}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:()=>{var e;return null===(e=eS.current)||void 0===e?void 0:e.click()},disabled:ek,children:ek?"Uploading…":"Upload image"}),eL&&(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:eW,children:eU?"Hide uploaded":"Browse uploaded"}),(0,n.jsx)("input",{ref:eS,type:"file",accept:"image/jpeg,image/png,.jpg,.jpeg,.png",className:"hidden",onChange:e=>{var t;let l=null===(t=e.target.files)||void 0===t?void 0:t[0];l&&eX(l),e.currentTarget.value=""}})]}),(0,n.jsxs)("label",{className:"grid gap-1 mt-2 max-w-[240px]",children:[(0,n.jsx)("span",{children:"Image behavior"}),(0,n.jsxs)("select",{value:null!==(X=null!==(H=ey.imageBehavior)&&void 0!==H?H:null==ex?void 0:ex.imageBehavior)&&void 0!==X?X:"contain",onChange:e=>ej({...ey,imageBehavior:e.target.value}),children:[(0,n.jsx)("option",{value:"contain",children:"contain (default)"}),(0,n.jsx)("option",{value:"cover",children:"cover"})]})]}),(null!==(q=null!==(W=ey.imageSrc)&&void 0!==W?W:null==ex?void 0:ex.imageSrc)&&void 0!==q?q:eT)&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"text-[11px] text-gray-600 mb-1",children:"Preview"}),(0,n.jsx)("div",{className:"w-[200px] h-[120px] bg-white border rounded overflow-hidden flex items-center justify-center",children:(0,n.jsx)("img",{src:null!==(Y=null!==(G=ey.imageSrc)&&void 0!==G?G:null==ex?void 0:ex.imageSrc)&&void 0!==Y?Y:eT,style:{objectFit:null!==(Z=null!==(Q=ey.imageBehavior)&&void 0!==Q?Q:null==ex?void 0:ex.imageBehavior)&&void 0!==Z?Z:"contain",width:"100%",height:"100%",objectPosition:"center"},alt:"preview"})})]}),eU&&(0,n.jsx)("div",{className:"mt-2 border rounded p-2 bg-white max-h-[200px] overflow-auto",children:0===eP.length?(0,n.jsx)("div",{className:"text-[11px] text-gray-600",children:"No uploaded images found."}):(0,n.jsx)("div",{className:"grid grid-cols-3 gap-2",children:eP.map(e=>(0,n.jsxs)("button",{className:"border rounded overflow-hidden hover:ring-1 hover:ring-blue-500",onClick:()=>ej({...ey,imageSrc:e.url}),title:e.name,children:[(0,n.jsx)("img",{src:e.url,alt:e.name,className:"w-full h-[80px] object-cover"}),(0,n.jsx)("div",{className:"text-[10px] px-1 py-1 truncate text-left",children:e.name})]},e.id))})})]}),"animation"===ef&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsx)("div",{className:"text-[11px] text-gray-600",children:"Upload Lottie JSON file (max 2MB)."}),eC&&(0,n.jsx)("div",{className:"text-[11px] text-red-600",children:eC}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:()=>{var e;return null===(e=eI.current)||void 0===e?void 0:e.click()},disabled:ek,children:ek?"Uploading…":"Upload Lottie JSON"}),(0,n.jsx)("input",{ref:eI,type:"file",accept:"application/json,.json",className:"hidden",onChange:e=>{var t;let l=null===(t=e.target.files)||void 0===t?void 0:t[0];l&&eq(l),e.currentTarget.value=""}})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:void 0!==ey.loopEnabled?ey.loopEnabled:null==ex||!ex.loop||"boolean"==typeof ex.loop&&ex.loop,onChange:e=>{e.target.checked?ej({...ey,loopEnabled:!0,loop:!0}):ej({...ey,loopEnabled:!1,loop:!1})}}),(0,n.jsx)("span",{children:"Loop animation"})]}),(void 0!==ey.loopEnabled?ey.loopEnabled:null==ex||!ex.loop||"boolean"==typeof ex.loop&&ex.loop)&&(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsxs)("select",{value:null!==(V=ey.loopMode)&&void 0!==V?V:"infinite",onChange:e=>{if("infinite"===e.target.value)ej({...ey,loop:!0,loopMode:"infinite"});else{var t;let e=null!==(t=ey.loopCount)&&void 0!==t?t:3;ej({...ey,loop:e,loopMode:"count"})}},className:"text-xs border rounded p-1",children:[(0,n.jsx)("option",{value:"infinite",children:"Infinite"}),(0,n.jsx)("option",{value:"count",children:"Count"})]}),"count"===ey.loopMode&&(0,n.jsx)("input",{type:"number",min:"1",max:"999",value:null!==($=ey.loopCount)&&void 0!==$?$:3,onChange:e=>{let t=parseInt(e.target.value)||1;ej({...ey,loopCount:t,loop:t})},className:"text-xs border rounded p-1",placeholder:"Loop count"})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:void 0!==ey.autoplay?ey.autoplay:null===(ee=null==ex?void 0:ex.autoplay)||void 0===ee||ee,onChange:e=>ej({...ey,autoplay:e.target.checked})}),(0,n.jsx)("span",{children:"Autoplay"})]}),(eA||ey.lottieSrc||(null==ex?void 0:ex.lottieSrc))&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"text-[11px] text-gray-600 mb-1",children:"Preview"}),(0,n.jsx)("div",{className:"w-[100px] h-[100px] bg-white border rounded overflow-hidden flex items-center justify-center",children:(0,n.jsx)(i(),{animationData:eA,loop:!0,autoplay:!0,style:{width:"100%",height:"100%"},renderer:"canvas",rendererSettings:{progressiveLoad:!0,clearCanvas:!0,preserveAspectRatio:"none",dpr:window.devicePixelRatio}})})]})]}),"dune"===ef&&(0,n.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Dune URL or Query ID"}),(0,n.jsx)("input",{placeholder:"https://dune.com/queries/4880231/8081146 or 4880231",value:null!==(eo=null!==(ea=null!==(en=null!==(el=null!==(et=ey.duneInput)&&void 0!==et?et:ey.duneQueryId)&&void 0!==el?el:null==ex?void 0:null===(b=ex.dune)||void 0===b?void 0:b.sourceUrl)&&void 0!==en?en:null==ex?void 0:null===(y=ex.dune)||void 0===y?void 0:y.queryId)&&void 0!==ea?ea:null==ex?void 0:ex.duneQueryId)&&void 0!==eo?eo:"",onChange:e=>ej({...ey,duneInput:e.target.value})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:'Dates column (e.g. "week")'}),(0,n.jsx)("input",{placeholder:"week",value:null!==(er=null!==(ei=ey.datesColumn)&&void 0!==ei?ei:null==ex?void 0:null===(j=ex.dune)||void 0===j?void 0:j.datesColumn)&&void 0!==er?er:"",onChange:e=>ej({...ey,datesColumn:e.target.value})})]}),(0,n.jsxs)("label",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Dates to show"}),(0,n.jsx)("input",{type:"number",min:"2",max:"20",placeholder:"4",value:null!==(es=null!==(ed=ey.datesToShow)&&void 0!==ed?ed:null==ex?void 0:null===(w=ex.dune)||void 0===w?void 0:w.datesToShow)&&void 0!==es?es:4,onChange:e=>ej({...ey,datesToShow:parseInt(e.target.value)||4})})]}),(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("span",{children:"Value(s) to visualize"}),ew.map((e,t)=>(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("input",{placeholder:"e.g. total_members_all_networks",value:e,onChange:e=>{let l=[...ew];l[t]=e.target.value,eN(l)}}),ew.length>1&&(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-red-100 text-red-700 hover:bg-red-200",onClick:()=>eN(ew.filter((e,l)=>l!==t)),children:"Remove"})]},t)),(0,n.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-gray-100 hover:bg-gray-200",onClick:()=>eN([...ew,""]),children:"+ Add another value"})]})]})]})]})})}function F(e){let{projectId:t,canvasId:l,selectedId:o,initialName:i}=e,[r,d]=(0,a.useState)(!1),[s,c]=(0,a.useState)(i);(0,a.useEffect)(()=>{c(i)},[i]);let u=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),l=e.getFullYear(),n=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(l).concat(n).concat(a).concat(o).concat(i).concat(r)},g=async e=>{let n=e.trim();if(!n){d(!1),c(i);return}let a="".concat(n,"_").concat(u()),r=(0,v.JU)((0,v.ad)(),"interoperable-canvas",t,"canvases",l,"overlay",o);await (0,v.pl)(r,{name:n,nameKey:a},{merge:!0}),d(!1)};return r?(0,n.jsx)("input",{className:"text-sm font-semibold border rounded px-1 py-0.5 min-w-0",autoFocus:!0,value:s,onChange:e=>c(e.target.value),onBlur:()=>g(s),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),g(s)),"Escape"===e.key&&(e.preventDefault(),d(!1),c(i))}}):(0,n.jsx)("button",{className:"text-sm font-semibold truncate",title:s,onClick:()=>d(!0),children:s})}var O=l(1642),J=l(5566);let K={apiKey:J.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:J.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:J.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:J.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:J.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:J.env.NEXT_PUBLIC_FIREBASE_APP_ID},H=(0,u.C6)().length?(0,u.C6)()[0]:(0,u.ZF)(K),X=(0,v.ad)(H),W=(0,g.cF)(H);function q(e){let{projectId:t,scope:l={type:"root"},canvasId:o="root"}=e,[i,r]=(0,a.useState)(l),[d,s]=(0,a.useState)([]),[u,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(!1),x=(0,a.useRef)(!1);(0,a.useEffect)(()=>{{let e=new URLSearchParams(window.location.search),t="true"===e.get("presentation");h(t),x.current=t,m("true"===e.get("fullscreen"))}},[]);let f=c(e=>e.aspect),b=c(e=>e.setAspect),y=c(e=>e.background),j=c(e=>e.setBackground),w=c(e=>e.layers),k=c(e=>e.setLayers),B=c(e=>e.ui);c(e=>e.openLayersModal);let T=c(e=>e.closeLayersModal),_=c(e=>e.closeBackgroundModal),A="linear"===y.mode?"linear-gradient(135deg, ".concat(y.from,", ").concat(y.to,")"):"radial"===y.mode?"radial-gradient(circle, ".concat(y.from,", ").concat(y.to,")"):"solid"===y.mode?y.from:"zigzag"===y.mode?"zigzag":"",L=function(){for(var e=arguments.length,l=Array(e),n=0;n<e;n++)l[n]=arguments[n];if(!t)return l;let a=["interoperable-canvas",t];return"child"===i.type&&a.push("child-canvases",i.childId),a.push("canvases",o),[...a,...l]};(0,a.useEffect)(()=>{if(!t){s([]);return}(async()=>{try{let e=(0,v.hJ)(X,["interoperable-canvas",t,"child-canvases"].join("/")),l=await (0,v.PL)(e),n=[];l.forEach(e=>n.push(e.id)),s(n.sort())}catch(e){s([])}})()},[t]);let z=(0,a.useRef)(!1);(0,a.useEffect)(()=>{if(!t)return;let e=L().join("/");console.log("[CanvasApp] Loading canvas from path:",e);let l=(0,v.JU)(X,e),n=async()=>{try{let e;let t=(await (0,v.QT)(l)).data(),n=null==t?void 0:t.zIndexMap,a=Array.isArray(null==t?void 0:t.layers)?t.layers:[],o=L("overlay").join("/"),i=(0,v.hJ)(X,o),r=await (0,v.PL)(i),d=[];if(r.forEach(e=>d.push({id:e.id,...e.data()})),a.length>1){let t=a.filter(e=>"background"!==e),l=t.map(e=>d.find(t=>t.id===e)).filter(e=>!!e),n=d.filter(e=>!t.includes(e.id)&&"background"!==e.id);e=[...l,...n.sort((e,t)=>{var l,n,a,o;let i=(null!==(n=null!==(l=e.nameKey)&&void 0!==l?l:e.id)&&void 0!==n?n:"").toString(),r=(null!==(o=null!==(a=t.nameKey)&&void 0!==a?a:t.id)&&void 0!==o?o:"").toString();return i.localeCompare(r)})]}else if(n&&Object.keys(n).length>0){let t=Object.keys(n).sort((e,t)=>{var l,a;return(null!==(l=n[e])&&void 0!==l?l:999)-(null!==(a=n[t])&&void 0!==a?a:999)}).filter(e=>"background"!==e).map(e=>d.find(t=>t.id===e)).filter(e=>!!e),l=d.filter(e=>!n[e.id]&&"background"!==e.id);e=[...t,...l.sort((e,t)=>{var l,n,a,o;let i=(null!==(n=null!==(l=e.nameKey)&&void 0!==l?l:e.id)&&void 0!==n?n:"").toString(),r=(null!==(o=null!==(a=t.nameKey)&&void 0!==a?a:t.id)&&void 0!==o?o:"").toString();return i.localeCompare(r)})]}else e=d.filter(e=>"string"==typeof e.id&&e.id.trim()).sort((e,t)=>{var l,n,a,o;let i=(null!==(n=null!==(l=e.nameKey)&&void 0!==l?l:e.id)&&void 0!==n?n:"").toString(),r=(null!==(o=null!==(a=t.nameKey)&&void 0!==a?a:t.id)&&void 0!==o?o:"").toString();return i.localeCompare(r)});let s=e.map(e=>e.id),c=["background",...s],u={};c.forEach((e,t)=>{u[e]=t}),await (0,v.pl)(l,{layers:c,zIndexMap:u},{merge:!0});let g=c.map((t,l)=>{var n,a;return{id:t,name:"background"===t?"Background":null!==(a=null===(n=e.find(e=>e.id===t))||void 0===n?void 0:n.name)&&void 0!==a?a:t,z:l}});k(g)}catch(e){console.error("[CanvasApp] Failed to rebuild layers from overlay:",e),k([{id:"background",name:"Background",z:0}])}finally{setTimeout(()=>{z.current=!1},100)}},a=(0,v.cf)(l,async e=>{z.current=!0;let t=e.data();if(console.log("[CanvasApp] Received data:",{hasBackground:!!(null==t?void 0:t.background),background:null==t?void 0:t.background}),(null==t?void 0:t.background)&&"object"==typeof t.background){var l,a,o;j({mode:null!==(l=t.background.mode)&&void 0!==l?l:"none",from:null!==(a=t.background.from)&&void 0!==a?a:"#000000",to:null!==(o=t.background.to)&&void 0!==o?o:"#000000"})}else j({mode:"linear",from:"rgb(50, 250, 150)",to:"rgb(150, 200, 250)"});if((null==t?void 0:t.aspect)&&b(t.aspect),Array.isArray(null==t?void 0:t.layers)&&t.layers.length>0){let e=t.layers;k((x.current?e:"background"===e[0]?e:["background",...e.filter(e=>"background"!==e)]).map((e,t)=>({id:e,name:"background"===e?"Background":e,z:t}))),setTimeout(()=>{z.current=!1},100)}else x.current?(k([{id:"background",name:"Background",z:0}]),setTimeout(()=>{z.current=!1},100)):await n()});return()=>a()},[t,i,o,j,b,k]);let U=async e=>{if(u||(j(e),!t))return;let l=(0,v.JU)(X,L().join("/"));await (0,v.pl)(l,{background:e},{merge:!0})},R=async e=>{if(u||(b(e),!t))return;let l=(0,v.JU)(X,L().join("/"));await (0,v.pl)(l,{aspect:e},{merge:!0})},P=(0,a.useRef)(null),F=e=>{t&&!u&&(P.current&&clearTimeout(P.current),P.current=setTimeout(async()=>{let t=e.filter(e=>e&&e.id&&"string"==typeof e.id&&""!==e.id.trim()).map(e=>e.id).filter((e,t,l)=>l.indexOf(e)===t),l="background"===t[0]?t:["background",...t.filter(e=>"background"!==e)],n={};l.forEach((e,t)=>{n[e]=t});let a=(0,v.JU)(X,L().join("/"));l.length>0&&Object.keys(n).length>0&&await (0,v.pl)(a,{layers:l,zIndexMap:n},{merge:!0})},200))};(0,a.useEffect)(()=>{!t||z.current||x.current||F(w)},[t,w]);let J=!u;return(0,n.jsxs)("div",{className:"min-h-screen flex ".concat("bg-gray-800"),children:[!u&&(0,n.jsxs)("div",{className:"fixed left-0 top-0 h-screen w-48 p-4 bg-gray-900 flex flex-col gap-3 overflow-y-auto",children:[(0,n.jsx)(O.Z,{}),(0,n.jsxs)("div",{className:J?"":"opacity-50 pointer-events-none",children:[(0,n.jsx)(S,{}),(0,n.jsx)(I,{onAspectChange:R}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Canvas Scope"}),(0,n.jsxs)("select",{value:"root"===i.type?"root":"child:".concat(i.childId),onChange:e=>{let t=e.target.value;"root"===t?r({type:"root"}):t.startsWith("child:")&&r({type:"child",childId:t.split(":")[1]||"mini-app-test"})},className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",disabled:!J,children:[(0,n.jsx)("option",{value:"root",children:"Root"}),d.map(e=>(0,n.jsxs)("option",{value:"child:".concat(e),children:["Child: ",e]},e))]})]}),(0,n.jsx)("button",{className:"w-full px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{var e;if(!t||!J)return;let l=null===(e=prompt("New child canvas id (e.g., mini-app-test-2)"))||void 0===e?void 0:e.trim();if(!l)return;let n=["interoperable-canvas",t,"child-canvases",l].join("/");await (0,v.pl)((0,v.JU)(X,n),{createdAt:Date.now()},{merge:!0});let a=["interoperable-canvas",t,"child-canvases",l,"canvases","root"].join("/");await (0,v.pl)((0,v.JU)(X,a),{aspect:null!=f?f:"1:1",createdAt:Date.now()},{merge:!0});try{let e="interoperable-canvas/assets/".concat(t,"/child-canvases/").concat(l,"/images/.keep"),n=new Blob(["placeholder"],{type:"text/plain"});await (0,g.KV)((0,g.iH)(W,e),n,{cacheControl:"no-store"})}catch(e){}r({type:"child",childId:l});try{let e=(0,v.hJ)(X,["interoperable-canvas",t,"child-canvases"].join("/")),l=await (0,v.PL)(e),n=[];l.forEach(e=>n.push(e.id)),s(n.sort())}catch(e){}},disabled:!J,children:"New Child Canvas"})]})]}),(0,n.jsx)("div",{className:"overflow-hidden ".concat(u?"w-full flex justify-center":"flex-1 ml-48"),children:(0,n.jsx)(E,{aspect:f,backgroundColor:A,backgroundMode:y.mode,backgroundFrom:y.from,backgroundTo:y.to,presentation:u,fullscreen:p,children:(0,n.jsx)("div",{className:"w-full h-full",children:(0,n.jsx)(N,{projectId:null!=t?t:"demo",scope:i,canvasId:o,presentation:u,isAuthorized:!!u||J})})})}),(0,n.jsx)(C,{open:B.showBackgroundModal,mode:y.mode,from:y.from,to:y.to,onClose:()=>_(),onSave:e=>{U(e),_()}}),(0,n.jsx)(M,{open:B.showLayersModal,onClose:()=>T(),projectId:null!=t?t:"demo",canvasId:o,scope:i}),(0,n.jsx)(D,{projectId:null!=t?t:"demo",canvasId:o,scope:i})]})}},1642:function(e,t,l){l.d(t,{Z:function(){return i}});var n=l(7437),a=l(2265),o=l(2850);function i(){let[e,t]=(0,a.useState)(null),[l,i]=(0,a.useState)(null),[r,d]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{var e,l,n,a;let r=window;if(!r.ethereum)return;let d=new o.Q(r.ethereum),s=await d.listAccounts();s&&s.length>0&&t(s[0].address);let c=await d.getNetwork();i(c.chainId.toString()),null===(e=(l=r.ethereum).on)||void 0===e||e.call(l,"accountsChanged",e=>{var l;t(null!==(l=null==e?void 0:e[0])&&void 0!==l?l:null)}),null===(n=(a=r.ethereum).on)||void 0===n||n.call(a,"chainChanged",()=>{window.location.reload()})}catch(e){}})()},[]);let s=async()=>{try{d(null);let e=window;if(!e.ethereum){d("MetaMask not found. Please install it to connect.");return}let l=new o.Q(e.ethereum);await l.send("eth_requestAccounts",[]);let n=await l.getSigner(),a=await n.getAddress();t(a);let r=await l.getNetwork();i(r.chainId.toString())}catch(t){var e;d(null!==(e=null==t?void 0:t.message)&&void 0!==e?e:"Failed to connect wallet")}};return(0,n.jsxs)("div",{className:"space-y-2",children:[e?(0,n.jsxs)("div",{className:"text-xs text-gray-300 break-all",children:[(0,n.jsx)("div",{children:"Connected"}),(0,n.jsx)("div",{className:"font-mono",children:e}),l&&(0,n.jsxs)("div",{className:"opacity-80",children:["Chain: ",l]}),(0,n.jsx)("button",{className:"mt-2 w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:()=>{t(null),i(null)},children:"Disconnect (local)"})]}):(0,n.jsx)("button",{className:"w-full px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",onClick:s,children:"Connect Wallet (MetaMask)"}),r&&(0,n.jsx)("div",{className:"text-[11px] text-red-400",children:r}),(0,n.jsx)("div",{className:"text-[11px] text-gray-400",children:"Note: Replace this with your preferred login method (e.g. Privy, Wagmi, RainbowKit)."})]})}}}]);