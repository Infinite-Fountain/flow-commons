"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[865],{4865:function(e,t,n){n.d(t,{s:function(){return O}});var l=n(7437),a=n(2265),o=n(2006),i=n(903),r=n(2844);let d=(0,i.U)()((0,r.n)(e=>({aspect:"1:1",setAspect:t=>e(e=>{e.aspect=t}),background:{mode:"solid",from:"#000000",to:"#000000"},setBackground:t=>e(e=>{e.background=t}),items:[],overlay:[],setOverlay:t=>e(e=>{e.overlay=t}),layers:[{id:"background",name:"Background",z:0}],ui:{showBackgroundModal:!1,showLayersModal:!1,showBoxModal:!1,currentTool:"none"},selectedId:null,addItem:t=>e(e=>{e.items.push(t)}),updateItem:(t,n)=>e(e=>{let l=e.items.findIndex(e=>e.id===t);l>=0&&Object.assign(e.items[l],n)}),setItems:t=>e(e=>{e.items=t}),addOverlay:t=>e(e=>{e.overlay.push(t)}),updateOverlay:(t,n)=>e(e=>{let l=e.overlay.findIndex(e=>e.id===t);l>=0&&Object.assign(e.overlay[l],n)}),addLayer:t=>e(e=>{e.layers.push(t)}),setLayers:t=>e(e=>{e.layers=t}),moveLayerUp:t=>e(e=>{if("background"===t)return;let n=e.layers.findIndex(e=>e.id===t);if(n>=0&&n<e.layers.length-1){let t=e.layers[n];e.layers[n]=e.layers[n+1],e.layers[n+1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),moveLayerDown:t=>e(e=>{let n=e.layers.findIndex(e=>e.id===t);if(n>0){var l;if((null===(l=e.layers[n-1])||void 0===l?void 0:l.id)==="background")return;let t=e.layers[n];e.layers[n]=e.layers[n-1],e.layers[n-1]=t,e.layers.forEach((e,t)=>{e.z=t})}}),openBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!0}),closeBackgroundModal:()=>e(e=>{e.ui.showBackgroundModal=!1}),openLayersModal:()=>e(e=>{e.ui.showLayersModal=!0}),closeLayersModal:()=>e(e=>{e.ui.showLayersModal=!1}),setTool:t=>e(e=>{e.ui.currentTool=t}),setSelectedId:t=>e(e=>{e.selectedId=t}),openBoxModal:t=>e(e=>{e.selectedId=t,e.ui.showBoxModal=!0}),closeBoxModal:()=>e(e=>{e.ui.showBoxModal=!1}),createBox:t=>{let n=t.id;if(!n){let e=Math.random().toString(36).slice(2,7);n="box_".concat(Date.now(),"_").concat(e)}let l=Math.max(16,Math.round(t.w)),a=Math.max(16,Math.round(t.h));return e(e=>{var o,i;let r=e.layers.length;e.overlay.push({id:n,x:Math.round(t.x),y:Math.round(t.y),w:l,h:a,contentType:null!==(o=t.contentType)&&void 0!==o?o:"none"}),e.layers.push({id:n,name:null!==(i=t.name)&&void 0!==i?i:n,z:r}),e.ui.currentTool="none",e.selectedId=n}),n}})));var s=n(5236),c=n(9842),u=n(5566);let v={apiKey:u.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:u.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:u.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:u.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:u.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:u.env.NEXT_PUBLIC_FIREBASE_APP_ID},h=(0,s.C6)().length?(0,s.C6)()[0]:(0,s.ZF)(v),g=(0,c.ad)(h);function x(e){let{projectId:t="demo",canvasId:n="root",scope:i={type:"root"}}=e,r=d(e=>e.overlay),s=d(e=>e.setOverlay),u=d(e=>e.updateOverlay),v=d(e=>e.layers),h=d(e=>e.setLayers),x=d(e=>e.createBox),p=d(e=>e.ui.currentTool),f=d(e=>e.setTool),b=d(e=>e.openBoxModal),y=(0,a.useRef)(null),[j,w]=(0,a.useState)(null),[N,I]=(0,a.useState)(null),S=d(e=>e.selectedId),E=d(e=>e.setSelectedId),k=(0,a.useMemo)(()=>{let e={};return v.forEach(t=>{e[t.id]=t.z}),e},[v]),C=()=>{let e=["interoperable-canvas",t];return(null==i?void 0:i.type)==="child"&&e.push("child-canvases",i.childId),e.push("canvases",n),e};return(0,a.useEffect)(()=>{if(!t)return;let e=(0,c.hJ)(g,C().concat(["overlay"]).join("/")),n=(0,c.cf)(e,e=>{let t=[];e.forEach(e=>t.push(e.data())),s(t);let n={};t.forEach(e=>{(null==e?void 0:e.id)&&(n[e.id]=e.name||e.id)});let l={};v.forEach(e=>{l[e.id]=e});let a=[];a.push({id:"background",name:"Background",z:0}),v.filter(e=>"background"!==e.id).forEach(e=>{var t,l;let o=null!==(l=null!==(t=n[e.id])&&void 0!==t?t:e.name)&&void 0!==l?l:e.id;a.push({...e,name:o})}),t.forEach(e=>{if(!l[e.id]){var t;a.push({id:e.id,name:null!==(t=n[e.id])&&void 0!==t?t:e.id,z:a.length})}});let o=a.map((e,t)=>({...e,z:t}));(o.length!==v.length||o.some((e,t)=>{var n,l;return(null===(n=v[t])||void 0===n?void 0:n.id)!==e.id||(null===(l=v[t])||void 0===l?void 0:l.name)!==e.name}))&&h(o)});return()=>n()},[t,n,(null==i?void 0:i.type)==="child"?i.childId:"root",s]),(0,l.jsxs)("div",{ref:y,className:"w-full h-full absolute inset-0",style:{zIndex:1},onPointerDown:e=>{var t;if("add-box"!==p)return;let n=null===(t=y.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;let l=e.clientX-n.left,a=e.clientY-n.top;w({x:l,y:a}),I({x:l,y:a,w:0,h:0})},onPointerMove:e=>{var t;if("add-box"!==p||!j)return;let n=null===(t=y.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;let l=e.clientX-n.left,a=e.clientY-n.top,o=Math.min(j.x,l);I({x:o,y:Math.min(j.y,a),w:Math.abs(l-j.x),h:Math.abs(a-j.y)})},onPointerUp:()=>{if("add-box"!==p||!j||!N)return;let e=Math.max(40,N.w),t=Math.max(40,N.h),n=x({x:N.x,y:N.y,w:e,h:t}),l=(0,c.JU)(g,C().concat(["overlay",n]).join("/")),a=(Array.isArray(r)?r.length:0)+1,o="Box ".concat(a),i="".concat(o,"_").concat((()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),n=e.getFullYear(),l=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(n).concat(l).concat(a).concat(o).concat(i).concat(r)})());(0,c.pl)(l,{id:n,x:Math.round(N.x),y:Math.round(N.y),w:e,h:t,contentType:"none",name:o,nameKey:i},{merge:!0}),E(n),w(null),I(null),f("none")},children:[r.map(e=>{var t,n,a,i,r,d,s,v,h,x,p,f;return(0,l.jsx)(o.s,{size:{width:e.w,height:e.h},position:{x:e.x,y:e.y},onDragStop:(t,n)=>{let l=Math.round(n.x),a=Math.round(n.y);u(e.id,{x:l,y:a});let o=(0,c.JU)(g,C().concat(["overlay",e.id]).join("/"));(0,c.pl)(o,{x:l,y:a},{merge:!0})},onResizeStop:(t,n,l,a,o)=>{let i=Math.round(l.offsetWidth),r=Math.round(l.offsetHeight),d=Math.round(o.x),s=Math.round(o.y);u(e.id,{w:i,h:r,x:d,y:s});let v=(0,c.JU)(g,C().concat(["overlay",e.id]).join("/"));(0,c.pl)(v,{w:i,h:r,x:d,y:s},{merge:!0})},bounds:"parent",style:{border:e.id===S?"2px solid #ffcf33":"1px solid rgba(255,255,255,0.25)",background:(()=>{var t,n,l,a,o;let i=e.background;return i&&"none"!==i.mode?"solid"===i.mode?null!==(t=i.from)&&void 0!==t?t:"#000000":"linear"===i.mode?"linear-gradient(135deg, ".concat(null!==(n=i.from)&&void 0!==n?n:"#000000",", ").concat(null!==(l=i.to)&&void 0!==l?l:"#000000",")"):"radial"===i.mode?"radial-gradient(circle, ".concat(null!==(a=i.from)&&void 0!==a?a:"#000000",", ").concat(null!==(o=i.to)&&void 0!==o?o:"#000000",")"):"transparent":"transparent"})(),borderRadius:8,overflow:"hidden",zIndex:null!==(s=k[e.id])&&void 0!==s?s:1},onClick:()=>E(e.id),onDoubleClick:()=>b(e.id),children:(0,l.jsxs)("div",{className:"w-full h-full",children:["text"===e.contentType&&(0,l.jsx)(m,{text:null!==(v=null===(t=e.text)||void 0===t?void 0:t.content)&&void 0!==v?v:"",color:null!==(h=null===(n=e.text)||void 0===n?void 0:n.color)&&void 0!==h?h:"#ffffff",bold:!!(null===(a=e.text)||void 0===a?void 0:a.bold),align:null!==(x=null===(i=e.text)||void 0===i?void 0:i.align)&&void 0!==x?x:"left",fitToWidth:!!(null===(r=e.text)||void 0===r?void 0:r.fitToWidth),baseFontSize:null!==(p=null===(d=e.text)||void 0===d?void 0:d.fontSize)&&void 0!==p?p:18}),"image"===e.contentType&&e.imageSrc&&(0,l.jsx)("img",{src:e.imageSrc,alt:"",style:{width:"100%",height:"100%",objectFit:null!==(f=e.imageBehavior)&&void 0!==f?f:"contain",objectPosition:"center"}})]})},e.id)}),"add-box"===p&&N&&(0,l.jsx)("div",{className:"absolute border-2 border-blue-400/70 bg-blue-400/10",style:{left:N.x,top:N.y,width:N.w,height:N.h,pointerEvents:"none"}})]})}function m(e){let{text:t,color:n,bold:o,align:i,fitToWidth:r,baseFontSize:d}=e,s=(0,a.useRef)(null),[c,u]=(0,a.useState)(d),[v,h]=(0,a.useState)(1.2);return(0,a.useEffect)(()=>{if(!r){u(d),h(1.2);return}let e=s.current;if(!e)return;let n=e.parentElement;if(!n)return;let l=()=>{let e=n.clientWidth-16,l=n.clientHeight-16;if(e<=0||l<=0)return;let a=t.length,o=Math.ceil(.6*a*d/e);u(Math.max(8,Math.min(200,Math.floor(Math.min(e/(.6*a),l/1.2,l/(1.2*o)))))),h(1.2)};l();let a=new ResizeObserver(l);return a.observe(n),()=>{a.disconnect()}},[r,d,t]),(0,l.jsx)("div",{ref:s,style:{color:n,fontSize:c,fontWeight:o?700:400,lineHeight:v,display:"flex",alignItems:"center",justifyContent:"left"===i?"flex-start":"center"===i?"center":"flex-end",width:"100%",height:"100%",padding:8,textAlign:i,wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:t})}function p(e){let{projectId:t="demo",scope:n={type:"root"},canvasId:a="root"}=e;return(0,l.jsx)("div",{className:"w-full h-full relative",children:(0,l.jsx)(x,{projectId:t,canvasId:a,scope:n})})}function f(){let e=d(e=>e.openBackgroundModal),t=d(e=>e.setTool);return(0,l.jsxs)("div",{className:"space-y-2 relative",children:[(0,l.jsx)("button",{className:"w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>t("add-box"),children:"Add Box"}),(0,l.jsx)("button",{className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>e(),children:"Background"}),(0,l.jsx)("button",{className:"w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:d.getState().openLayersModal,children:"Layers"})]})}function b(e){let{onAspectChange:t}=e,{aspect:n,setAspect:a}=d(),o=e=>{a(e),null==t||t(e)};return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Aspect Ratio"}),(0,l.jsxs)("select",{value:n,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",children:[(0,l.jsx)("option",{value:"16:9",children:"16:9 (Widescreen)"}),(0,l.jsx)("option",{value:"4:3",children:"4:3 (Standard)"}),(0,l.jsx)("option",{value:"1:1",children:"1:1 (Square)"}),(0,l.jsx)("option",{value:"4:6",children:"4:6 (Vertical Post)"}),(0,l.jsx)("option",{value:"9:16",children:"9:16 (Vertical Stories)"}),(0,l.jsx)("option",{value:"mini-app",children:"Mini App (9:16 safe)"})]})]})}function y(e){let{aspect:t,backgroundColor:n,className:a="",children:o,presentation:i=!1}=e,r=()=>{switch(t){case"1:1":default:return"aspect-square";case"16:9":return"aspect-video";case"4:3":return"aspect-[4/3]";case"9:16":case"mini-app":return"aspect-[9/16]";case"4:6":return"aspect-[4/6]"}},d=()=>"1:1"===t?"".concat(r()," h-[95%] max-w-full mx-[10px]"):"16:9"===t?"".concat(r()," w-full max-h-full mx-[20px]"):"4:3"===t?"".concat(r()," h-[95%] max-w-full mx-[20px]"):"".concat(r()," h-[95%] max-w-full mx-[10px]");return"mini-app"===t?(0,l.jsx)("div",{className:"".concat("w-full h-screen flex items-center justify-center"," ").concat(a),children:(0,l.jsx)("div",{className:d(),children:(0,l.jsxs)("div",{className:"w-full h-full relative overflow-hidden",style:{background:n||"transparent"},children:[!i&&(0,l.jsx)("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:0,height:"10%",background:"#ffffff",borderBottom:"1px solid rgba(0,0,0,0.08)",pointerEvents:"none",zIndex:2}}),(0,l.jsx)("div",{style:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,top:i?"0%":"10%",bottom:"2.5%"},children:(0,l.jsx)("div",{className:"w-full h-full relative",style:{zIndex:1},children:o})})]})})}):(0,l.jsx)("div",{className:"".concat("w-full h-screen flex items-center justify-center"," ").concat(a),children:(0,l.jsx)("div",{className:d(),children:(0,l.jsx)("div",{className:"w-full h-full relative overflow-hidden",style:{background:n||"transparent"},children:o})})})}function j(e){let{open:t,mode:n,from:o,to:i,onClose:r,onSave:d}=e,[s,c]=(0,a.useState)(null!=n?n:"linear"),[u,v]=(0,a.useState)(o),[h,g]=(0,a.useState)(i);a.useEffect(()=>{t&&(c(null!=n?n:"linear"),v(o),g(i))},[t,n,o,i]);let x=(0,a.useMemo)(()=>"solid"===s?u:"linear"===s?"linear-gradient(135deg, ".concat(u,", ").concat(h,")"):"radial"===s?"radial-gradient(circle, ".concat(u,", ").concat(h,")"):"transparent",[s,u,h]);return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Background"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"h-24 rounded",style:{background:x}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Type"}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 border rounded",value:s,onChange:e=>c(e.target.value),children:[(0,l.jsx)("option",{value:"none",children:"No background"}),(0,l.jsx)("option",{value:"solid",children:"Solid"}),(0,l.jsx)("option",{value:"linear",children:"Linear gradient"}),(0,l.jsx)("option",{value:"radial",children:"Radial gradient"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"From Color"}),(0,l.jsx)("input",{type:"color",value:u,onChange:e=>v(e.target.value),className:"w-full h-10 border rounded"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"To Color"}),(0,l.jsx)("input",{type:"color",value:h,onChange:e=>g(e.target.value),className:"w-full h-10 border rounded"})]})]}),(0,l.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,l.jsx)("button",{onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"}),(0,l.jsx)("button",{onClick:()=>{"none"===s?d({mode:"none",from:"transparent",to:"transparent"}):"solid"===s?d({mode:"solid",from:u,to:u}):"linear"===s?d({mode:"linear",from:u,to:h}):"radial"===s&&d({mode:"radial",from:u,to:h})},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"})]})]})}):null}var w=n(5566);let N={apiKey:w.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:w.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:w.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:w.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:w.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:w.env.NEXT_PUBLIC_FIREBASE_APP_ID},I=(0,s.C6)().length?(0,s.C6)()[0]:(0,s.ZF)(N),S=(0,c.ad)(I);function E(e){let{open:t,onClose:n,projectId:o,canvasId:i="root",scope:r={type:"root"}}=e,s=d(e=>e.layers),u=d(e=>e.overlay),v=d(e=>e.moveLayerUp),h=d(e=>e.moveLayerDown),g=d(e=>e.selectedId),x=d(e=>e.setSelectedId),[m,p]=(0,a.useState)(null),[f,b]=(0,a.useState)(""),y=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),n=e.getFullYear(),l=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(n).concat(l).concat(a).concat(o).concat(i).concat(r)},j=()=>{let e=["interoperable-canvas",o];return(null==r?void 0:r.type)==="child"&&e.push("child-canvases",r.childId),e.push("canvases",i),e},w=async(e,t)=>{if(!t.trim()||!o){p(null);return}let n="".concat(t.trim(),"_").concat(y()),l=(0,c.JU)(S,j().concat(["overlay",e]).join("/"));await (0,c.pl)(l,{name:t.trim(),nameKey:n},{merge:!0}),p(null)};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white text-gray-900 p-6 rounded-lg max-w-md w-full mx-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Layers"}),(0,l.jsx)("button",{onClick:n,className:"px-3 py-1 border rounded hover:bg-gray-50",children:"Close"})]}),(0,l.jsxs)("div",{className:"space-y-2 max-h-80 overflow-auto",children:[0===s.length&&(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"No layers yet. Add items to populate."}),[...s].sort((e,t)=>t.z-e.z).map(e=>{var t;return(0,l.jsxs)("div",{className:"flex items-center justify-between border rounded px-3 py-2 ".concat(g===e.id?"bg-gray-100":""),onClick:()=>"background"!==e.id&&x(e.id),children:[(0,l.jsx)("div",{className:"truncate",children:m===e.id?(0,l.jsx)("input",{className:"text-sm border rounded px-1 py-0.5 w-40",autoFocus:!0,value:f,onChange:e=>b(e.target.value),onKeyDown:t=>{var n;let l=(null===(n=u.find(t=>t.id===e.id))||void 0===n?void 0:n.name)||e.name||e.id;"Enter"===t.key&&(t.preventDefault(),w(e.id,f||l)),"Escape"===t.key&&p(null)},onBlur:()=>{var t;let n=(null===(t=u.find(t=>t.id===e.id))||void 0===t?void 0:t.name)||e.name||e.id;w(e.id,f||n)}}):(0,l.jsx)("button",{className:"font-medium text-left truncate",onClick:t=>{var n;t.stopPropagation();let l=(null===(n=u.find(t=>t.id===e.id))||void 0===n?void 0:n.name)||e.name||e.id;p(e.id),b(l)},children:(null===(t=u.find(t=>t.id===e.id))||void 0===t?void 0:t.name)||e.name||e.id})}),(0,l.jsxs)("div",{className:"flex gap-1",children:["background"!==e.id&&(0,l.jsx)("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Up",onClick:t=>{t.stopPropagation(),v(e.id)},children:"▲"}),"background"!==e.id&&e.z>1&&(0,l.jsx)("button",{className:"w-6 h-6 grid place-items-center text-xs border rounded hover:bg-gray-50",title:"Move Down",onClick:t=>{t.stopPropagation(),h(e.id)},children:"▼"})]})]},e.id)})]})]})}):null}var k=n(9854),C=n(5566);let _={apiKey:C.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:C.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:C.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:C.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:C.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:C.env.NEXT_PUBLIC_FIREBASE_APP_ID},B=(0,s.C6)().length?(0,s.C6)()[0]:(0,s.ZF)(_),A=(0,c.ad)(B),M=(0,k.cF)(B);function T(e){var t,n,o,i,r,s,u,v,h,g,x,m,p,f,b,y,j,w,N,I,S,E,C,_,B,T,U,R,L,D,F,z,O,K,J,X,W,G,H,Q,Y,Z;let{projectId:V="demo",canvasId:q="root",scope:$={type:"root"}}=e,ee=d(e=>e.ui.showBoxModal),et=d(e=>e.closeBoxModal),en=d(e=>e.selectedId),el=d(e=>e.overlay),ea=(0,a.useMemo)(()=>el.find(e=>e.id===en),[el,en]),[eo,ei]=(0,a.useState)("background"),[er,ed]=(0,a.useState)({}),es=(0,a.useRef)(null),[ec,eu]=(0,a.useState)(!1),[ev,eh]=(0,a.useState)(null),[eg,ex]=(0,a.useState)(null),[em,ep]=(0,a.useState)(!1),[ef,eb]=(0,a.useState)(!1),[ey,ej]=(0,a.useState)([]),[ew,eN]=(0,a.useState)(!1),eI=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),n=e.getFullYear(),l=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(n).concat(l).concat(a).concat(o).concat(i).concat(r)},eS=async()=>{try{let e=(0,c.hJ)(A,"interoperable-canvas",V,"images"),t=(0,c.IO)(e,(0,c.b9)(1)),n=await (0,c.PL)(t);ep(!n.empty)}catch(e){ep(!1)}},eE=async()=>{try{let t=(0,c.hJ)(A,"interoperable-canvas",V,"images"),n=await (0,c.PL)(t),l=[];for(let t of n.docs){var e;let n=t.data(),a=null==n?void 0:n.storagePath,o=null!==(e=null==n?void 0:n.filename)&&void 0!==e?e:t.id;if(a)try{let e=(0,k.iH)(M,a),n=await (0,k.Jt)(e);l.push({id:t.id,name:o,url:n})}catch(e){}}ej(l)}catch(e){ej([])}};if((0,a.useEffect)(()=>{ee&&"image"===eo&&eS()},[ee,eo,V]),(0,a.useEffect)(()=>{var e;if(!ee)return;let t=null!==(e=null==ea?void 0:ea.contentType)&&void 0!==e?e:"none";"text"===t||"image"===t||"animation"===t||"dune"===t?ei(t):ei("background")},[ee,en,null==ea?void 0:ea.contentType]),!ee||!en)return null;let ek=async e=>{if(eh(null),e){if(!("image/jpeg"===e.type||"image/png"===e.type)){eh("Only JPG or PNG files are accepted.");return}if(e.size>1048576){eh("Maximum size is 1MB.");return}eu(!0);try{var t,n;let l=e.name,a=l.lastIndexOf("."),o=a>-1?l.slice(0,a):l,i=a>-1?l.slice(a+1):"jpg",r="".concat(o,"_").concat(eI(),".").concat(i),d=(null==$?void 0:$.type)==="child"?"interoperable-canvas/assets/".concat(V,"/child-canvases/").concat($.childId,"/images/").concat(r):"interoperable-canvas/assets/".concat(V,"/images/").concat(r),s=(0,k.iH)(M,d);await (0,k.KV)(s,e,{contentType:e.type,cacheControl:"public, max-age=31536000, immutable"});let u=await (0,k.Jt)(s),v=URL.createObjectURL(e);ex(v);let h=await new Promise(e=>{let t=new Image;t.onload=()=>{e({width:t.naturalWidth,height:t.naturalHeight}),URL.revokeObjectURL(v)},t.src=v}),g=(0,c.JU)(A,"interoperable-canvas",V,"images",r);await (0,c.pl)(g,{filename:r,originalName:l,storagePath:d,mimeType:e.type,sizeBytes:e.size,width:h.width,height:h.height,uploadedAt:(0,c.Bt)()},{merge:!0}),ed({...er,imageSrc:u,imageBehavior:null!==(n=null!==(t=er.imageBehavior)&&void 0!==t?t:null==ea?void 0:ea.imageBehavior)&&void 0!==n?n:"contain"}),ep(!0)}catch(e){eh("Upload failed. Please try again.")}finally{eu(!1)}}},eC=async()=>{let e=!ef;eb(e),e&&0===ey.length&&await eE()},e_=()=>{let e=["interoperable-canvas",V];return(null==$?void 0:$.type)==="child"&&e.push("child-canvases",$.childId),e.push("canvases",q),e},eB=async()=>{var e,t,n,l,a,o,i,r,d,s,u,v,h,g,x,m,p,f,b,y;if(!en)return;let j=(0,c.JU)(A,e_().concat(["overlay",en]).join("/")),w={};"background"===eo&&(w.background=null!==(e=er.background)&&void 0!==e?e:{mode:"none"});let N="text"===eo?"text":"image"===eo?"image":"animation"===eo?"animation":"dune"===eo?"dune":null;if(N&&(null==ea?void 0:ea.contentType)&&ea.contentType!==N){let e={text:"text",image:"image",animation:"animation",dune:"dune"},n=null!==(t=e[ea.contentType])&&void 0!==t?t:null;if(n&&!window.confirm("You can only add one asset per box. Adding ".concat(e[N]," will remove ").concat(n,". Continue?")))return}if("text"===eo&&(w.contentType="text",w.text={content:null!==(s=null!==(d=er.text)&&void 0!==d?d:null==ea?void 0:null===(n=ea.text)||void 0===n?void 0:n.content)&&void 0!==s?s:"",fontSize:void 0!==er.fontSize?Number(er.fontSize):null!==(u=null==ea?void 0:null===(l=ea.text)||void 0===l?void 0:l.fontSize)&&void 0!==u?u:18,color:null!==(h=null!==(v=er.color)&&void 0!==v?v:null==ea?void 0:null===(a=ea.text)||void 0===a?void 0:a.color)&&void 0!==h?h:"#ffffff",bold:void 0!==er.bold?!!er.bold:null!==(g=null==ea?void 0:null===(o=ea.text)||void 0===o?void 0:o.bold)&&void 0!==g&&g,align:null!==(m=null!==(x=er.align)&&void 0!==x?x:null==ea?void 0:null===(i=ea.text)||void 0===i?void 0:i.align)&&void 0!==m?m:"left",fitToWidth:void 0!==er.fitToWidth?!!er.fitToWidth:null!==(p=null==ea?void 0:null===(r=ea.text)||void 0===r?void 0:r.fitToWidth)&&void 0!==p&&p},Object.assign(w,{imageSrc:(0,c.AK)(),lottieSrc:(0,c.AK)(),duneQueryId:(0,c.AK)()})),"image"===eo){let e=null!==(f=er.imageSrc)&&void 0!==f?f:null==ea?void 0:ea.imageSrc;if(!e){window.alert("Please upload or select an image before saving.");return}Object.assign(w,{contentType:"image",imageSrc:e,imageBehavior:null!==(y=null!==(b=er.imageBehavior)&&void 0!==b?b:null==ea?void 0:ea.imageBehavior)&&void 0!==y?y:"contain"}),Object.assign(w,{text:(0,c.AK)(),lottieSrc:(0,c.AK)(),duneQueryId:(0,c.AK)()})}"animation"===eo&&(Object.assign(w,{contentType:"animation",lottieSrc:er.lottieSrc}),Object.assign(w,{text:(0,c.AK)(),imageSrc:(0,c.AK)(),duneQueryId:(0,c.AK)()})),"dune"===eo&&(Object.assign(w,{contentType:"dune",duneQueryId:er.duneQueryId}),Object.assign(w,{text:(0,c.AK)(),imageSrc:(0,c.AK)(),lottieSrc:(0,c.AK)()})),await (0,c.pl)(j,w,{merge:!0}),et()},eA=async()=>{if(en)try{let e=(0,c.JU)(A,e_().concat(["overlay",en]).join("/"));await (0,c.oe)(e);let t=(0,c.JU)(A,e_().join("/")),n=await (0,c.QT)(t);if(n.exists()){let e=n.data(),l=(Array.isArray(null==e?void 0:e.layers)?[...e.layers]:[]).filter(e=>e!==en),a={};l.forEach((e,t)=>{a[e]=t}),await (0,c.pl)(t,{layers:l,zIndexMap:a},{merge:!0})}}finally{eN(!1),et()}},eM=e=>{var t;let{id:n,label:a}=e,o=eo===n,i=(null!==(t=null==ea?void 0:ea.contentType)&&void 0!==t?t:"none")===n,r=o&&!i?" bg-gray-200":"",d=o||i?"":" bg-white hover:bg-gray-50";return(0,l.jsx)("button",{className:"".concat("px-2 py-1 text-xs border rounded").concat(i?" bg-green-100 border-green-600 text-green-800":"").concat(r).concat(d),onClick:()=>ei(n),children:a})};return(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:(0,l.jsxs)("div",{className:"bg-white text-gray-900 p-4 rounded-lg w-[560px] max-w-[95vw]",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("div",{className:"flex items-center gap-2 min-w-0",children:(0,l.jsx)(P,{projectId:V,canvasId:q,selectedId:en,initialName:(null==ea?void 0:ea.name)||en})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[!ew&&(0,l.jsx)("button",{className:"px-2 py-1 text-xs border rounded text-red-700 border-red-600 hover:bg-red-50",onClick:()=>eN(!0),children:"Delete box"}),ew&&(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-[11px] text-red-700",children:"Delete this box? This cannot be undone."}),(0,l.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-red-600 text-white",onClick:eA,children:"Yes, delete"}),(0,l.jsx)("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>eN(!1),children:"No, go back"})]}),(0,l.jsx)("button",{className:"px-2 py-1 text-xs border rounded",onClick:et,children:"Close"}),(0,l.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-blue-600 text-white",onClick:eB,children:"Save"})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[(0,l.jsx)(eM,{id:"background",label:"Background"}),(0,l.jsx)(eM,{id:"text",label:"Text"}),(0,l.jsx)(eM,{id:"image",label:"Image"}),(0,l.jsx)(eM,{id:"animation",label:"Animation"}),(0,l.jsx)(eM,{id:"dune",label:"Dune"})]}),(0,l.jsxs)("div",{className:"border rounded p-3 bg-gray-50",children:["background"===eo&&(0,l.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"Mode"}),(0,l.jsxs)("select",{value:null!==(f=null!==(p=null===(t=er.background)||void 0===t?void 0:t.mode)&&void 0!==p?p:null==ea?void 0:null===(n=ea.background)||void 0===n?void 0:n.mode)&&void 0!==f?f:"none",onChange:e=>{var t;return ed({...er,background:{...null!==(t=er.background)&&void 0!==t?t:{},mode:e.target.value}})},children:[(0,l.jsx)("option",{value:"none",children:"None"}),(0,l.jsx)("option",{value:"solid",children:"Solid"}),(0,l.jsx)("option",{value:"linear",children:"Linear"}),(0,l.jsx)("option",{value:"radial",children:"Radial"})]})]}),(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"From"}),(0,l.jsx)("input",{type:"color",value:null!==(y=null!==(b=null===(o=er.background)||void 0===o?void 0:o.from)&&void 0!==b?b:null==ea?void 0:null===(i=ea.background)||void 0===i?void 0:i.from)&&void 0!==y?y:"#000000",onChange:e=>{var t;return ed({...er,background:{...null!==(t=er.background)&&void 0!==t?t:{},from:e.target.value}})}})]}),(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"To"}),(0,l.jsx)("input",{type:"color",value:null!==(w=null!==(j=null===(r=er.background)||void 0===r?void 0:r.to)&&void 0!==j?j:null==ea?void 0:null===(s=ea.background)||void 0===s?void 0:s.to)&&void 0!==w?w:"#000000",onChange:e=>{var t;return ed({...er,background:{...null!==(t=er.background)&&void 0!==t?t:{},to:e.target.value}})}})]})]}),"text"===eo&&(0,l.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"Text"}),(0,l.jsx)("input",{value:null!==(I=null!==(N=er.text)&&void 0!==N?N:null==ea?void 0:null===(u=ea.text)||void 0===u?void 0:u.content)&&void 0!==I?I:"",onChange:e=>ed({...er,text:e.target.value})})]}),(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"Font size"}),(0,l.jsx)("input",{type:"number",value:null!==(E=null!==(S=er.fontSize)&&void 0!==S?S:null==ea?void 0:null===(v=ea.text)||void 0===v?void 0:v.fontSize)&&void 0!==E?E:18,onChange:e=>ed({...er,fontSize:Number(e.target.value)})})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:null!==(_=null!==(C=er.fitToWidth)&&void 0!==C?C:null==ea?void 0:null===(h=ea.text)||void 0===h?void 0:h.fitToWidth)&&void 0!==_&&_,onChange:e=>ed({...er,fitToWidth:e.target.checked})}),(0,l.jsx)("span",{children:"Auto fit width"})]}),(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"Color"}),(0,l.jsx)("input",{type:"color",value:null!==(T=null!==(B=er.color)&&void 0!==B?B:null==ea?void 0:null===(g=ea.text)||void 0===g?void 0:g.color)&&void 0!==T?T:"#ffffff",onChange:e=>ed({...er,color:e.target.value})})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:null!==(R=null!==(U=er.bold)&&void 0!==U?U:null==ea?void 0:null===(x=ea.text)||void 0===x?void 0:x.bold)&&void 0!==R&&R,onChange:e=>ed({...er,bold:e.target.checked})}),(0,l.jsx)("span",{children:"Bold"})]}),(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"Align"}),(0,l.jsxs)("select",{value:null!==(D=null!==(L=er.align)&&void 0!==L?L:null==ea?void 0:null===(m=ea.text)||void 0===m?void 0:m.align)&&void 0!==D?D:"left",onChange:e=>ed({...er,align:e.target.value}),children:[(0,l.jsx)("option",{value:"left",children:"Left"}),(0,l.jsx)("option",{value:"center",children:"Center"}),(0,l.jsx)("option",{value:"right",children:"Right"})]})]})]}),"image"===eo&&(0,l.jsxs)("div",{className:"grid gap-2 text-xs",children:[(0,l.jsx)("div",{className:"text-[11px] text-gray-600",children:"Accepted formats: JPG/PNG. Max size: 1MB."}),ev&&(0,l.jsx)("div",{className:"text-[11px] text-red-600",children:ev}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:()=>{var e;return null===(e=es.current)||void 0===e?void 0:e.click()},disabled:ec,children:ec?"Uploading…":"Upload image"}),em&&(0,l.jsx)("button",{className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50",onClick:eC,children:ef?"Hide uploaded":"Browse uploaded"}),(0,l.jsx)("input",{ref:es,type:"file",accept:"image/jpeg,image/png,.jpg,.jpeg,.png",className:"hidden",onChange:e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&ek(n),e.currentTarget.value=""}})]}),(0,l.jsxs)("label",{className:"grid gap-1 mt-2 max-w-[240px]",children:[(0,l.jsx)("span",{children:"Image behavior"}),(0,l.jsxs)("select",{value:null!==(z=null!==(F=er.imageBehavior)&&void 0!==F?F:null==ea?void 0:ea.imageBehavior)&&void 0!==z?z:"contain",onChange:e=>ed({...er,imageBehavior:e.target.value}),children:[(0,l.jsx)("option",{value:"contain",children:"contain (default)"}),(0,l.jsx)("option",{value:"cover",children:"cover"})]})]}),(null!==(K=null!==(O=er.imageSrc)&&void 0!==O?O:null==ea?void 0:ea.imageSrc)&&void 0!==K?K:eg)&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("div",{className:"text-[11px] text-gray-600 mb-1",children:"Preview"}),(0,l.jsx)("div",{className:"w-[200px] h-[120px] bg-white border rounded overflow-hidden flex items-center justify-center",children:(0,l.jsx)("img",{src:null!==(X=null!==(J=er.imageSrc)&&void 0!==J?J:null==ea?void 0:ea.imageSrc)&&void 0!==X?X:eg,style:{objectFit:null!==(G=null!==(W=er.imageBehavior)&&void 0!==W?W:null==ea?void 0:ea.imageBehavior)&&void 0!==G?G:"contain",width:"100%",height:"100%",objectPosition:"center"},alt:"preview"})})]}),ef&&(0,l.jsx)("div",{className:"mt-2 border rounded p-2 bg-white max-h-[200px] overflow-auto",children:0===ey.length?(0,l.jsx)("div",{className:"text-[11px] text-gray-600",children:"No uploaded images found."}):(0,l.jsx)("div",{className:"grid grid-cols-3 gap-2",children:ey.map(e=>(0,l.jsxs)("button",{className:"border rounded overflow-hidden hover:ring-1 hover:ring-blue-500",onClick:()=>ed({...er,imageSrc:e.url}),title:e.name,children:[(0,l.jsx)("img",{src:e.url,alt:e.name,className:"w-full h-[80px] object-cover"}),(0,l.jsx)("div",{className:"text-[10px] px-1 py-1 truncate text-left",children:e.name})]},e.id))})})]}),"animation"===eo&&(0,l.jsx)("div",{className:"grid gap-2 text-xs",children:(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"Lottie JSON URL"}),(0,l.jsx)("input",{value:null!==(Q=null!==(H=er.lottieSrc)&&void 0!==H?H:null==ea?void 0:ea.lottieSrc)&&void 0!==Q?Q:"",onChange:e=>ed({...er,lottieSrc:e.target.value})})]})}),"dune"===eo&&(0,l.jsx)("div",{className:"grid gap-2 text-xs",children:(0,l.jsxs)("label",{className:"grid gap-1",children:[(0,l.jsx)("span",{children:"Dune Query ID"}),(0,l.jsx)("input",{value:null!==(Z=null!==(Y=er.duneQueryId)&&void 0!==Y?Y:null==ea?void 0:ea.duneQueryId)&&void 0!==Z?Z:"",onChange:e=>ed({...er,duneQueryId:e.target.value})})]})})]})]})})}function P(e){let{projectId:t,canvasId:n,selectedId:o,initialName:i}=e,[r,d]=(0,a.useState)(!1),[s,u]=(0,a.useState)(i);(0,a.useEffect)(()=>{u(i)},[i]);let v=()=>{let e=new Date,t=e=>String(e).padStart(2,"0"),n=e.getFullYear(),l=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return"".concat(n).concat(l).concat(a).concat(o).concat(i).concat(r)},h=async e=>{let l=e.trim();if(!l){d(!1),u(i);return}let a="".concat(l,"_").concat(v()),r=(0,c.JU)((0,c.ad)(),"interoperable-canvas",t,"canvases",n,"overlay",o);await (0,c.pl)(r,{name:l,nameKey:a},{merge:!0}),d(!1)};return r?(0,l.jsx)("input",{className:"text-sm font-semibold border rounded px-1 py-0.5 min-w-0",autoFocus:!0,value:s,onChange:e=>u(e.target.value),onBlur:()=>h(s),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),h(s)),"Escape"===e.key&&(e.preventDefault(),d(!1),u(i))}}):(0,l.jsx)("button",{className:"text-sm font-semibold truncate",title:s,onClick:()=>d(!0),children:s})}var U=n(1642),R=n(5566);let L={apiKey:R.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:R.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:R.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:R.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:R.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:R.env.NEXT_PUBLIC_FIREBASE_APP_ID},D=(0,s.C6)().length?(0,s.C6)()[0]:(0,s.ZF)(L),F=(0,c.ad)(D),z=(0,k.cF)(D);function O(e){let{projectId:t,scope:n={type:"root"},canvasId:o="root"}=e,[i,r]=(0,a.useState)(n),[s,u]=(0,a.useState)([]),v=d(e=>e.aspect),h=d(e=>e.setAspect),g=d(e=>e.background),x=d(e=>e.setBackground),m=d(e=>e.layers),w=d(e=>e.setLayers),N=d(e=>e.ui);d(e=>e.openLayersModal);let I=d(e=>e.closeLayersModal),S=d(e=>e.closeBackgroundModal),C="linear"===g.mode?"linear-gradient(135deg, ".concat(g.from,", ").concat(g.to,")"):"radial"===g.mode?"radial-gradient(circle, ".concat(g.from,", ").concat(g.to,")"):"solid"===g.mode?g.from:"",_=function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];if(!t)return n;let a=["interoperable-canvas",t];return"child"===i.type&&a.push("child-canvases",i.childId),a.push("canvases",o),[...a,...n]};(0,a.useEffect)(()=>{if(!t){u([]);return}(async()=>{try{let e=(0,c.hJ)(F,["interoperable-canvas",t,"child-canvases"].join("/")),n=await (0,c.PL)(e),l=[];n.forEach(e=>l.push(e.id)),u(l.sort())}catch(e){u([])}})()},[t]),(0,a.useEffect)(()=>{if(!t)return;let e=(0,c.JU)(F,_().join("/")),n=(0,c.cf)(e,t=>{let n=t.data();if((null==n?void 0:n.background)&&"object"==typeof n.background){var l,a,o;x({mode:null!==(l=n.background.mode)&&void 0!==l?l:"none",from:null!==(a=n.background.from)&&void 0!==a?a:"#000000",to:null!==(o=n.background.to)&&void 0!==o?o:"#000000"})}else x({mode:"linear",from:"rgb(50, 250, 150)",to:"rgb(150, 200, 250)"}),(0,c.pl)(e,{background:{mode:"linear",from:"rgb(50, 250, 150)",to:"rgb(150, 200, 250)"}},{merge:!0});if((null==n?void 0:n.aspect)&&h(n.aspect),Array.isArray(null==n?void 0:n.layers)){let e=n.layers;w(("background"===e[0]?e:["background",...e.filter(e=>"background"!==e)]).map((e,t)=>({id:e,name:"background"===e?"Background":e,z:t})))}else w([{id:"background",name:"Background",z:0}])});return()=>n()},[t,i,o,x,h,w]);let B=async e=>{if(x(e),!t)return;let n=(0,c.JU)(F,_().join("/"));await (0,c.pl)(n,{background:e},{merge:!0})},A=async e=>{if(h(e),!t)return;let n=(0,c.JU)(F,_().join("/"));await (0,c.pl)(n,{aspect:e},{merge:!0})},M=(0,a.useRef)(null),P=e=>{t&&(M.current&&clearTimeout(M.current),M.current=setTimeout(async()=>{let t=e.map(e=>e.id).filter((e,t,n)=>n.indexOf(e)===t),n="background"===t[0]?t:["background",...t.filter(e=>"background"!==e)],l={};n.forEach((e,t)=>{l[e]=t});let a=(0,c.JU)(F,_().join("/"));await (0,c.pl)(a,{layers:n,zIndexMap:l},{merge:!0})},200))};return(0,a.useEffect)(()=>{t&&P(m)},[t,m]),(0,l.jsxs)("div",{className:"min-h-screen flex bg-gray-800",children:[(0,l.jsxs)("div",{className:"w-48 p-4 bg-gray-900 flex flex-col gap-3",children:[(0,l.jsx)(U.Z,{}),(0,l.jsx)(f,{}),(0,l.jsx)(b,{onAspectChange:A}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Canvas Scope"}),(0,l.jsxs)("select",{value:"root"===i.type?"root":"child:".concat(i.childId),onChange:e=>{let t=e.target.value;"root"===t?r({type:"root"}):t.startsWith("child:")&&r({type:"child",childId:t.split(":")[1]||"mini-app-test"})},className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600",children:[(0,l.jsx)("option",{value:"root",children:"Root"}),s.map(e=>(0,l.jsxs)("option",{value:"child:".concat(e),children:["Child: ",e]},e))]})]}),(0,l.jsx)("button",{className:"w-full px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",onClick:async()=>{var e;if(!t)return;let n=null===(e=prompt("New child canvas id (e.g., mini-app-test-2)"))||void 0===e?void 0:e.trim();if(!n)return;let l=["interoperable-canvas",t,"child-canvases",n].join("/");await (0,c.pl)((0,c.JU)(F,l),{createdAt:Date.now()},{merge:!0});let a=["interoperable-canvas",t,"child-canvases",n,"canvases","root"].join("/");await (0,c.pl)((0,c.JU)(F,a),{aspect:null!=v?v:"1:1",createdAt:Date.now()},{merge:!0});try{let e="interoperable-canvas/assets/".concat(t,"/child-canvases/").concat(n,"/images/.keep"),l=new Blob(["placeholder"],{type:"text/plain"});await (0,k.KV)((0,k.iH)(z,e),l,{cacheControl:"no-store"})}catch(e){}r({type:"child",childId:n});try{let e=(0,c.hJ)(F,["interoperable-canvas",t,"child-canvases"].join("/")),n=await (0,c.PL)(e),l=[];n.forEach(e=>l.push(e.id)),u(l.sort())}catch(e){}},children:"New Child Canvas"})]}),(0,l.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,l.jsx)(y,{aspect:v,backgroundColor:C,children:(0,l.jsx)("div",{className:"w-full h-full",children:(0,l.jsx)(p,{projectId:null!=t?t:"demo",scope:i,canvasId:o})})})}),(0,l.jsx)(j,{open:N.showBackgroundModal,mode:g.mode,from:g.from,to:g.to,onClose:()=>S(),onSave:e=>{B(e),S()}}),(0,l.jsx)(E,{open:N.showLayersModal,onClose:()=>I(),projectId:null!=t?t:"demo",canvasId:o,scope:i}),(0,l.jsx)(T,{projectId:null!=t?t:"demo",canvasId:o,scope:i})]})}},1642:function(e,t,n){n.d(t,{Z:function(){return i}});var l=n(7437),a=n(2265),o=n(2850);function i(){let[e,t]=(0,a.useState)(null),[n,i]=(0,a.useState)(null),[r,d]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{var e,n,l,a;let r=window;if(!r.ethereum)return;let d=new o.Q(r.ethereum),s=await d.listAccounts();s&&s.length>0&&t(s[0].address);let c=await d.getNetwork();i(c.chainId.toString()),null===(e=(n=r.ethereum).on)||void 0===e||e.call(n,"accountsChanged",e=>{var n;t(null!==(n=null==e?void 0:e[0])&&void 0!==n?n:null)}),null===(l=(a=r.ethereum).on)||void 0===l||l.call(a,"chainChanged",()=>{window.location.reload()})}catch(e){}})()},[]);let s=async()=>{try{d(null);let e=window;if(!e.ethereum){d("MetaMask not found. Please install it to connect.");return}let n=new o.Q(e.ethereum);await n.send("eth_requestAccounts",[]);let l=await n.getSigner(),a=await l.getAddress();t(a);let r=await n.getNetwork();i(r.chainId.toString())}catch(t){var e;d(null!==(e=null==t?void 0:t.message)&&void 0!==e?e:"Failed to connect wallet")}};return(0,l.jsxs)("div",{className:"space-y-2",children:[e?(0,l.jsxs)("div",{className:"text-xs text-gray-300 break-all",children:[(0,l.jsx)("div",{children:"Connected"}),(0,l.jsx)("div",{className:"font-mono",children:e}),n&&(0,l.jsxs)("div",{className:"opacity-80",children:["Chain: ",n]}),(0,l.jsx)("button",{className:"mt-2 w-full px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-600",onClick:()=>{t(null),i(null)},children:"Disconnect (local)"})]}):(0,l.jsx)("button",{className:"w-full px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",onClick:s,children:"Connect Wallet (MetaMask)"}),r&&(0,l.jsx)("div",{className:"text-[11px] text-red-400",children:r}),(0,l.jsx)("div",{className:"text-[11px] text-gray-400",children:"Note: Replace this with your preferred login method (e.g. Privy, Wagmi, RainbowKit)."})]})}}}]);